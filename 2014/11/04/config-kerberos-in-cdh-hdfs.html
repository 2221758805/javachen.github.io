<!DOCTYPE html>
<html lang="zh-cn">
        <head>
      <meta charset="utf-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
      <title>HDFS配置Kerberos认证 - JavaChen Blog</title>
      <meta name="author" content="yuke"/>
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
      <link rel="canonical" href="http://blog.javachen.com/2014/11/04/config-kerberos-in-cdh-hdfs.html" />

      <link rel="stylesheet" href="/static/contrib/bootstrap/css/bootstrap.min.css" media="all" />
      <link rel="stylesheet" href="/static/css/style.css" media="all" />
      <link rel="stylesheet" href="/static/css/pygments.css" media="all" />
      <link rel="stylesheet" href="/static/contrib/font-awesome/css/font-awesome.min.css" media="all" />
      <link rel="stylesheet" type="text/css" href="/static/contrib/showup/showup.css" />

      <!-- atom & rss feed -->
      <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="JavaChen Blog RSS Feed" />
      <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="JavaChen Blog ATOM Feed" />

        <!-- fav and touch icons  -->
        <!-- Update these with your own images
        <link rel="shortcut icon" href="images/favicon.ico">
        <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
        -->

      <meta name="renderer" content="webkit|ie-stand">
      <meta name="baidu-site-verification" content="3HAhaWRiyR" />
      <meta name="360-site-verification" content="9b7a87a1d52051c96644f0a9b8b79898" />
      <meta name="sogou_site_verification" content="ofwXWFdthV"/>
      <meta property="wb:webmaster" content="b6081b2b8ab84c60" />
    </head>

    <body>
      <!--[if lte IE 9]>
<div class="alert alert-warning">
  <p>Your Internet Explorer is not supported. Please upgrade your Internet Explorer to version 9+, or use latest <a href="http://www.google.com/chrome/" target="_blank" class="alert-link">Google chrome</a>、<a href="http://www.mozilla.org/firefox/" target="_blank" class="alert-link">Mozilla Firefox</a>.</p>
  <p>If you are using IE 9 or later, make sure you <a href="http://windows.microsoft.com/en-us/internet-explorer/use-compatibility-view#ie=ie-8" target="_blank" class="alert-link">turn off "Compatibility view"</a>.</p>
</div>
<![endif]-->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">JavaChen Blog</a>
        </div>
        <div class="navbar-collapse collapse">
            <form id="search-form" class="form-group navbar-form navbar-right" role="search">
                  <div class="form-group">
                    <input type="text" name="q" value=""  id="query" class="form-control" placeholder="搜索" required autocomplete="off" ></input>
                    <input type="submit" class="btn btn-default" value=" Go" ></input>
                  </div>
              </form>
            <ul class="nav navbar-nav">
              <li><a href="/archive.html" title="Archive"><span class='fa fa-archive fa-2x'></span></a></li>
              <li><a href="/categories.html" title="Categories"><span class='fa fa-navicon fa-2x'></span></a></li>
              <li><a href="/tags.html" title="Tags"><span class='fa fa-tags fa-2x'></span></a></li>
              <li><a href="/about.html" title="About"><span class='fa fa-user fa-2x'></span></a></li>
              
              <li><a href="https://github.com/javachen" target="_blank" title="Github"><span class='fa fa-github fa-2x'></span></a></li>
              
              
              
              <li><a href="https://twitter.com/java_chen" target="_blank" title="twitter"><span class="fa fa-twitter fa-2x"></span></a></li>
              
              
              
              <li><a href="http://weibo.com/chenzhijun" target="_blank" title="Weibo"><span class="fa fa-weibo fa-2x"></span></a></li>
              
              <li><a href="/rss.xml" target="_blank" title="RSS"><span class='fa fa-rss fa-2x'></span></a></li>
            </ul>
        </div>

        </div><!--/.nav-collapse -->
      </div>
</div>

      <div id="wrap">
          <div class="container">
                 <div id="content">
          <ul class="pager hidden-print">
               
                <li class="previous"><a href="/2014/10/30/install-postgresql-on-mac-using-homebrew.html" title="Mac上使用homebrew安装PostgreSql"><i class="fa fa-angle-double-left"></i>&nbsp;Mac上使用homebrew安装PostgreSql</a></li>
                
                
                <li class="next"><a href="/2014/11/05/config-kerberos-in-cdh-yarn.html" title="YARN配置Kerberos认证">YARN配置Kerberos认证&nbsp;<i class="fa fa-angle-double-right"></i></a></li>
                
          </ul>

           <div id="post" class="clearfix">
              <div id="post-title" class="page-header text-center">
                  <h1> HDFS配置Kerberos认证  </h1>
              </div>
              <p class="text-muted clearfix">
                  <span class="pull-right">2014.11.04 | <a href="#comments">Comments</a></span>
              </p>
              <div id="qr" class="qrcode visible-lg"></div>

              <div id="post-text">
                    <p>本文主要记录 CDH Hadoop 集群上配置 HDFS 集成 Kerberos 的过程，包括 Kerberos 的安装和 Hadoop 相关配置修改说明。</p>

<h1 id="section">1. 环境说明</h1>

<p>系统环境：</p>

<ul>
  <li>操作系统：CentOs 6.6</li>
  <li>Hadoop版本：<code>CDH5.4</code></li>
  <li>JDK版本：<code>1.7.0_71</code></li>
  <li>运行用户：root</li>
</ul>

<p>集群各节点角色规划为：</p>

<pre><code>192.168.56.121        cdh1     NameNode、ResourceManager、HBase、Hive metastore、Impala Catalog、Impala statestore、Sentry 
192.168.56.122        cdh2     DataNode、SecondaryNameNode、NodeManager、HBase、Hive Server2、Impala Server
192.168.56.123        cdh3     DataNode、HBase、NodeManager、Hive Server2、Impala Server
</code></pre>

<p>cdh1作为master节点，其他节点作为slave节点，我们在cdh1节点安装kerberos Server，在其他节点安装kerberos client。</p>

<h1 id="section-1">2. 准备工作</h1>

<p>确认添加主机名解析到 <code>/etc/hosts</code> 文件中。</p>

<pre><code class="language-bash">$ cat /etc/hosts
127.0.0.1       localhost

192.168.56.121 cdh1
192.168.56.122 cdh2
192.168.56.123 cdh3
</code></pre>

<p>注意：hostname 请使用小写，要不然在集成 kerberos 时会出现一些错误。</p>

<h1 id="kerberos">3. 安装 Kerberos</h1>

<p>在 cdh1 上安装包 krb5、krb5-server 和 krb5-client。</p>

<pre><code class="language-bash">$ yum install krb5-server -y
</code></pre>

<p>在其他节点（cdh1、cdh2、cdh3）安装 krb5-devel、krb5-workstation ：</p>

<pre><code class="language-bash">#使用无密码登陆
$ ssh cdh1 "yum install krb5-devel krb5-workstation -y"
$ ssh cdh2 "yum install krb5-devel krb5-workstation -y"
$ ssh cdh3 "yum install krb5-devel krb5-workstation -y"
</code></pre>

<h1 id="section-2">4. 修改配置文件</h1>

<p>kdc 服务器涉及到三个配置文件：</p>

<pre><code>/etc/krb5.conf
/var/kerberos/krb5kdc/kdc.conf
/var/kerberos/krb5kdc/kadm5.acl
</code></pre>

<p>配置 Kerberos 的一种方法是编辑配置文件 /etc/krb5.conf。默认安装的文件中包含多个示例项。</p>

<pre><code class="language-ini">[logging]
 default = FILE:/var/log/krb5libs.log
 kdc = FILE:/var/log/krb5kdc.log
 admin_server = FILE:/var/log/kadmind.log

[libdefaults]
 default_realm = JAVACHEN.COM
 dns_lookup_realm = false
 dns_lookup_kdc = false
 ticket_lifetime = 24h
 renew_lifetime = 7d
 forwardable = true
 default_tgs_enctypes = aes256-cts-hmac-sha1-96
 default_tkt_enctypes = aes256-cts-hmac-sha1-96
 permitted_enctypes = aes256-cts-hmac-sha1-96
 clockskew = 120
 udp_preference_limit = 1

[realms]
 JAVACHEN.COM = {
  kdc = cdh1
  admin_server = cdh1
 }

[domain_realm]
 .javachen.com = JAVACHEN.COM
 javachen.com = JAVACHEN.COM
</code></pre>

<p>说明：</p>

<ul>
  <li><code>[logging]</code>：表示 server 端的日志的打印位置</li>
  <li><code>[libdefaults]</code>：每种连接的默认配置，需要注意以下几个关键的小配置
    <ul>
      <li><code>default_realm = JAVACHEN.COM</code>：设置 Kerberos 应用程序的默认领域。如果您有多个领域，只需向 [realms] 节添加其他的语句。</li>
      <li><code>ticket_lifetime</code>： 表明凭证生效的时限，一般为24小时。</li>
      <li><code>renew_lifetime</code>： 表明凭证最长可以被延期的时限，一般为一个礼拜。当凭证过期之后，对安全认证的服务的后续访问则会失败。</li>
      <li><code>clockskew</code>：时钟偏差是不完全符合主机系统时钟的票据时戳的容差，超过此容差将不接受此票据。通常，将时钟扭斜设置为 300 秒（5 分钟）。这意味着从服务器的角度看，票证的时间戳与它的偏差可以是在前后 5 分钟内。</li>
      <li><code>udp_preference_limit= 1</code>：禁止使用 udp 可以防止一个 Hadoop 中的错误</li>
    </ul>
  </li>
  <li><code>[realms]</code>：列举使用的 realm。
    <ul>
      <li><code>kdc</code>：代表要 kdc 的位置。格式是 <code>机器:端口</code></li>
      <li><code>admin_server</code>：代表 admin 的位置。格式是 <code>机器:端口</code></li>
      <li><code>default_domain</code>：代表默认的域名</li>
    </ul>
  </li>
  <li><code>[appdefaults]</code>：可以设定一些针对特定应用的配置，覆盖默认配置。</li>
</ul>

<p>修改 <code>/var/kerberos/krb5kdc/kdc.conf</code> ，该文件包含 Kerberos 的配置信息。例如，KDC 的位置，Kerbero 的 admin 的realms 等。需要所有使用的 Kerberos 的机器上的配置文件都同步。这里仅列举需要的基本配置。详细介绍参考：<a href="http://web.mit.edu/~kerberos/krb5-devel/doc/admin/conf_files/krb5_conf.html">krb5conf</a></p>

<pre><code class="language-ini">[kdcdefaults]
 kdc_ports = 88
 kdc_tcp_ports = 88

[realms]
 JAVACHEN.COM = {
  #master_key_type = aes256-cts
  acl_file = /var/kerberos/krb5kdc/kadm5.acl
  dict_file = /usr/share/dict/words
  max_renewable_life = 7d
  max_life = 1d
  admin_keytab = /var/kerberos/krb5kdc/kadm5.keytab
  supported_enctypes = aes256-cts:normal aes128-cts:normal des3-hmac-sha1:normal arcfour-hmac:normal des-hmac-sha1:normal des-cbc-md5:normal des-cbc-crc:normal
  default_principal_flags = +renewable, +forwardable
 }
</code></pre>

<p>说明：</p>

<ul>
  <li><code>JAVACHEN.COM</code>： 是设定的 realms。名字随意。Kerberos 可以支持多个 realms，会增加复杂度。大小写敏感，一般为了识别使用全部大写。这个 realms 跟机器的 host 没有大关系。</li>
  <li><code>master_key_type</code>：和 <code>supported_enctypes</code> 默认使用 <code>aes256-cts</code>。JAVA 使用 <code>aes256-cts</code> 验证方式需要安装 JCE 包，见下面的说明。为了简便，你可以不使用 <code>aes256-cts</code> 算法，这样就不需要安装 JCE 。</li>
  <li><code>acl_file</code>：标注了 admin 的用户权限，需要用户自己创建。文件格式是：<code>Kerberos_principal permissions [target_principal]  [restrictions]</code></li>
  <li><code>supported_enctypes</code>：支持的校验方式。</li>
  <li><code>admin_keytab</code>：KDC 进行校验的 keytab。</li>
</ul>

<blockquote>
  <p><strong>关于AES-256加密</strong>：</p>

  <p>对于使用 centos5. 6 及以上的系统，默认使用 <code>AES-256</code> 来加密的。这就需要集群中的所有节点上安装 JCE，如果你使用的是 JDK1.6 ，则到<br />
 <a href="http://www.oracle.com/technetwork/java/javase/downloads/jce-6-download-429243.html">Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files for JDK/JRE 6</a> 页面下载，如果是 JDK1.7，则到 <a href="http://www.oracle.com/technetwork/java/embedded/embedded-se/downloads/jce-7-download-432124.html">Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files for JDK/JRE 7</a> 下载。</p>

  <p>下载的文件是一个 zip 包，解开后，将里面的两个文件放到下面的目录中：<code>$JAVA_HOME/jre/lib/security</code></p>
</blockquote>

<p>为了能够不直接访问 KDC 控制台而从 Kerberos 数据库添加和删除主体，请对 Kerberos 管理服务器指示允许哪些主体执行哪些操作。通过编辑文件 /var/lib/kerberos/krb5kdc/kadm5.acl 完成此操作。ACL（访问控制列表）允许您精确指定特权。</p>

<pre><code class="language-bash">$ cat /var/kerberos/krb5kdc/kadm5.acl
  */admin@JAVACHEN.COM *
</code></pre>

<h1 id="section-3">5. 同步配置文件</h1>

<p>将 kdc 中的 <code>/etc/krb5.conf</code> 拷贝到集群中其他服务器即可。</p>

<pre><code class="language-bash">$ scp /etc/krb5.conf cdh2:/etc/krb5.conf
$ scp /etc/krb5.conf cdh3:/etc/krb5.conf
</code></pre>

<p>请确认集群如果关闭了 selinux。</p>

<h1 id="section-4">6. 创建数据库</h1>

<p>在 cdh1 上运行初始化数据库命令。其中 <code>-r</code> 指定对应 realm。</p>

<pre><code class="language-bash">$ kdb5_util create -r JAVACHEN.COM -s
</code></pre>

<p>出现 <code>Loading random data</code> 的时候另开个终端执行点消耗CPU的命令如 <code>cat /dev/sda &gt; /dev/urandom</code> 可以加快随机数采集。该命令会在 <code>/var/kerberos/krb5kdc/</code> 目录下创建 principal 数据库。</p>

<p>如果遇到数据库已经存在的提示，可以把 <code>/var/kerberos/krb5kdc/</code> 目录下的 principal 的相关文件都删除掉。默认的数据库名字都是 principal。可以使用 <code>-d</code> 指定数据库名字。</p>

<h1 id="section-5">7. 启动服务</h1>

<p>在 cdh1 节点上运行：</p>

<pre><code class="language-bash">$ chkconfig --level 35 krb5kdc on
$ chkconfig --level 35 kadmin on
$ service krb5kdc start
$ service kadmin start
</code></pre>

<h1 id="kerberos-">8. 创建 kerberos 管理员</h1>

<p>关于 kerberos 的管理，可以使用 <code>kadmin.local</code> 或 <code>kadmin</code>，至于使用哪个，取决于账户和访问权限：</p>

<ul>
  <li>如果有访问 kdc 服务器的 root 权限，但是没有 kerberos admin 账户，使用 <code>kadmin.local</code></li>
  <li>如果没有访问 kdc 服务器的 root 权限，但是用 kerberos admin 账户，使用 <code>kadmin</code></li>
</ul>

<p>在 cdh1 上创建远程管理的管理员：</p>

<pre><code class="language-bash">#手动输入两次密码，这里密码为 root
$ kadmin.local -q "addprinc root/admin"

# 也可以不用手动输入密码
$ echo -e "root\nroot" | kadmin.local -q "addprinc root/admin"

# 或者运行下面命令
$ kadmin.local &lt;&lt;eoj
addprinc -pw root root/admin
eoj
</code></pre>

<p>系统会提示输入密码，密码不能为空，且需妥善保存。</p>

<h1 id="kerberos-1">9. 测试 kerberos</h1>

<p>查看当前的认证用户：</p>

<pre><code class="language-bash"># 查看principals
$ kadmin: list_principals

  # 添加一个新的 principal
  kadmin:  addprinc user1
    WARNING: no policy specified for user1@JAVACHEN.COM; defaulting to no policy
    Enter password for principal "user1@JAVACHEN.COM":
    Re-enter password for principal "user1@JAVACHEN.COM":
    Principal "user1@JAVACHEN.COM" created.

  # 删除 principal
  kadmin:  delprinc user1
    Are you sure you want to delete the principal "user1@JAVACHEN.COM"? (yes/no): yes
    Principal "user1@JAVACHEN.COM" deleted.
    Make sure that you have removed this principal from all ACLs before reusing.

  kadmin: exit
</code></pre>

<p>也可以直接通过下面的命令来执行：</p>

<pre><code class="language-bash"># 提示需要输入密码
$ kadmin -p root/admin -q "list_principals"
$ kadmin -p root/admin -q "addprinc user2"
$ kadmin -p root/admin -q "delprinc user2"

# 不用输入密码
$ kadmin.local -q "list_principals"
$ kadmin.local -q "addprinc user2"
$ kadmin.local -q "delprinc user2"
</code></pre>

<p>创建一个测试用户 test，密码设置为 test：</p>

<pre><code class="language-bash">$ echo -e "test\ntest" | kadmin.local -q "addprinc test"
</code></pre>

<p>获取 test 用户的 ticket：</p>

<pre><code class="language-bash"># 通过用户名和密码进行登录
$ kinit test
Password for test@JAVACHEN.COM:

$ klist  -e
Ticket cache: FILE:/tmp/krb5cc_0
Default principal: test@JAVACHEN.COM

Valid starting     Expires            Service principal
11/07/14 15:29:02  11/08/14 15:29:02  krbtgt/JAVACHEN.COM@JAVACHEN.COM
  renew until 11/17/14 15:29:02, Etype (skey, tkt): aes256-cts-hmac-sha1-96, aes256-cts-hmac-sha1-96

Kerberos 4 ticket cache: /tmp/tkt0
klist: You have no tickets cached
</code></pre>

<p>销毁该 test 用户的 ticket：</p>

<pre><code class="language-bash">$ kdestroy

$ klist
klist: No credentials cache found (ticket cache FILE:/tmp/krb5cc_0)

Kerberos 4 ticket cache: /tmp/tkt0
klist: You have no tickets cached
</code></pre>

<p>更新 ticket：</p>

<pre><code class="language-bash">$ kinit root/admin
  Password for root/admin@JAVACHEN.COM:

$  klist
  Ticket cache: FILE:/tmp/krb5cc_0
  Default principal: root/admin@JAVACHEN.COM

  Valid starting     Expires            Service principal
  11/07/14 15:33:57  11/08/14 15:33:57  krbtgt/JAVACHEN.COM@JAVACHEN.COM
    renew until 11/17/14 15:33:57

  Kerberos 4 ticket cache: /tmp/tkt0
  klist: You have no tickets cached

$ kinit -R

$ klist
  Ticket cache: FILE:/tmp/krb5cc_0
  Default principal: root/admin@JAVACHEN.COM

  Valid starting     Expires            Service principal
  11/07/14 15:34:05  11/08/14 15:34:05  krbtgt/JAVACHEN.COM@JAVACHEN.COM
    renew until 11/17/14 15:33:57

  Kerberos 4 ticket cache: /tmp/tkt0
  klist: You have no tickets cached
</code></pre>

<p>抽取密钥并将其储存在本地 keytab 文件 /etc/krb5.keytab 中。这个文件由超级用户拥有，所以您必须是 root 用户才能在 kadmin shell 中执行以下命令：</p>

<pre><code class="language-bash">$ kadmin.local -q "ktadd kadmin/admin"

$ klist -k /etc/krb5.keytab
  Keytab name: FILE:/etc/krb5.keytab
  KVNO Principal
  ---- --------------------------------------------------------------------------
     3 kadmin/admin@LASHOU-INC.COM
     3 kadmin/admin@LASHOU-INC.COM
     3 kadmin/admin@LASHOU-INC.COM
     3 kadmin/admin@LASHOU-INC.COM
     3 kadmin/admin@LASHOU-INC.COM
</code></pre>

<h1 id="hdfs--kerberos">10. HDFS 上配置 kerberos</h1>

<h2 id="section-6">10.1 创建认证规则</h2>

<p>在 Kerberos 安全机制里，一个 principal 就是 realm 里的一个对象，一个 principal 总是和一个密钥（secret key）成对出现的。</p>

<p>这个 principal 的对应物可以是 service，可以是 host，也可以是 user，对于 Kerberos 来说，都没有区别。</p>

<p>Kdc(Key distribute center) 知道所有 principal 的 secret key，但每个 principal 对应的对象只知道自己的那个 secret key 。这也是“共享密钥“的由来。</p>

<p>对于 hadoop，principals 的格式为 <code>username/fully.qualified.domain.name@YOUR-REALM.COM</code>。</p>

<p>通过 yum 源安装的 cdh 集群中，NameNode 和 DataNode 是通过 hdfs 启动的，故为集群中每个服务器节点添加两个principals：hdfs、HTTP。</p>

<p>在 KCD server 上（这里是 cdh1）创建 hdfs principal：</p>

<pre><code class="language-bash">kadmin.local -q "addprinc -randkey hdfs/cdh1@JAVACHEN.COM"
kadmin.local -q "addprinc -randkey hdfs/cdh2@JAVACHEN.COM"
kadmin.local -q "addprinc -randkey hdfs/cdh3@JAVACHEN.COM"
</code></pre>

<p><code>-randkey</code> 标志没有为新 principal 设置密码，而是指示 kadmin 生成一个随机密钥。之所以在这里使用这个标志，是因为此 principal 不需要用户交互。它是计算机的一个服务器帐户。</p>

<p>创建 HTTP principal：</p>

<pre><code class="language-bash">kadmin.local -q "addprinc -randkey HTTP/cdh1@JAVACHEN.COM"
kadmin.local -q "addprinc -randkey HTTP/cdh2@JAVACHEN.COM"
kadmin.local -q "addprinc -randkey HTTP/cdh3@JAVACHEN.COM"
</code></pre>

<p>创建完成后，查看：</p>

<pre><code class="language-bash">$ kadmin.local -q "listprincs"
</code></pre>

<h2 id="keytab">10.2 创建keytab文件</h2>

<p>keytab 是包含 principals 和加密 principal key 的文件。keytab 文件对于每个 host 是唯一的，因为 key 中包含 hostname。keytab 文件用于不需要人工交互和保存纯文本密码，实现到 kerberos 上验证一个主机上的 principal。因为服务器上可以访问 keytab 文件即可以以 principal 的身份通过 kerberos 的认证，所以，keytab 文件应该被妥善保存，应该只有少数的用户可以访问。</p>

<p>创建包含 hdfs principal 和 host principal 的 hdfs keytab：</p>

<pre><code class="language-bash">xst -norandkey -k hdfs.keytab hdfs/fully.qualified.domain.name host/fully.qualified.domain.name
</code></pre>

<p>创建包含 mapred principal 和 host principal 的 mapred keytab：</p>

<pre><code class="language-bash">xst -norandkey -k mapred.keytab mapred/fully.qualified.domain.name host/fully.qualified.domain.name
</code></pre>

<blockquote>
  <p><strong>注意</strong>：<br />
上面的方法使用了xst的norandkey参数，有些kerberos不支持该参数。<br />
当不支持该参数时有这样的提示：<code>Principal -norandkey does not exist.</code>，需要使用下面的方法来生成keytab文件。</p>
</blockquote>

<p>在 cdh1 节点，即 KDC server 节点上执行下面命令：</p>

<pre><code class="language-bash">$ cd /var/kerberos/krb5kdc/

kadmin.local -q "xst  -k hdfs-unmerged.keytab  hdfs/cdh1@JAVACHEN.COM"
kadmin.local -q "xst  -k hdfs-unmerged.keytab  hdfs/cdh2@JAVACHEN.COM"
kadmin.local -q "xst  -k hdfs-unmerged.keytab  hdfs/cdh3@JAVACHEN.COM"

kadmin.local -q "xst  -k HTTP.keytab  HTTP/cdh1@JAVACHEN.COM"
kadmin.local -q "xst  -k HTTP.keytab  HTTP/cdh2@JAVACHEN.COM"
kadmin.local -q "xst  -k HTTP.keytab  HTTP/cdh3@JAVACHEN.COM"
</code></pre>

<p>这样，就会在 <code>/var/kerberos/krb5kdc/</code> 目录下生成 <code>hdfs-unmerged.keytab</code> 和 <code>HTTP.keytab</code> 两个文件，接下来使用 <code>ktutil</code> 合并者两个文件为 <code>hdfs.keytab</code>。</p>

<pre><code class="language-bash">$ cd /var/kerberos/krb5kdc/

$ ktutil
ktutil: rkt hdfs-unmerged.keytab
ktutil: rkt HTTP.keytab
ktutil: wkt hdfs.keytab
ktutil: exit
</code></pre>

<p>使用 klist 显示 hdfs.keytab 文件列表：</p>

<pre><code class="language-bash">$ klist -ket  hdfs.keytab
Keytab name: FILE:hdfs.keytab
KVNO Timestamp         Principal
---- ----------------- --------------------------------------------------------
   2 11/13/14 10:40:18 hdfs/cdh1@JAVACHEN.COM (aes256-cts-hmac-sha1-96)
   2 11/13/14 10:40:18 hdfs/cdh1@JAVACHEN.COM (aes128-cts-hmac-sha1-96)
   2 11/13/14 10:40:18 hdfs/cdh1@JAVACHEN.COM (des3-cbc-sha1)
   2 11/13/14 10:40:18 hdfs/cdh1@JAVACHEN.COM (arcfour-hmac)
   2 11/13/14 10:40:18 hdfs/cdh1@JAVACHEN.COM (des-hmac-sha1)
   2 11/13/14 10:40:18 hdfs/cdh1@JAVACHEN.COM (des-cbc-md5)
   2 11/13/14 10:40:18 hdfs/cdh2@JAVACHEN.COM (aes256-cts-hmac-sha1-96)
   2 11/13/14 10:40:18 hdfs/cdh2@JAVACHEN.COM (aes128-cts-hmac-sha1-96)
   2 11/13/14 10:40:18 hdfs/cdh2@JAVACHEN.COM (des3-cbc-sha1)
   2 11/13/14 10:40:18 hdfs/cdh2@JAVACHEN.COM (arcfour-hmac)
   2 11/13/14 10:40:18 hdfs/cdh2@JAVACHEN.COM (des-hmac-sha1)
   2 11/13/14 10:40:18 hdfs/cdh2@JAVACHEN.COM (des-cbc-md5)
   2 11/13/14 10:40:18 hdfs/cdh3@JAVACHEN.COM (aes256-cts-hmac-sha1-96)
   2 11/13/14 10:40:18 hdfs/cdh3@JAVACHEN.COM (aes128-cts-hmac-sha1-96)
   2 11/13/14 10:40:18 hdfs/cdh3@JAVACHEN.COM (des3-cbc-sha1)
   2 11/13/14 10:40:18 hdfs/cdh3@JAVACHEN.COM (arcfour-hmac)
   2 11/13/14 10:40:18 hdfs/cdh3@JAVACHEN.COM (des-hmac-sha1)
   2 11/13/14 10:40:18 hdfs/cdh3@JAVACHEN.COM (des-cbc-md5)
   2 11/13/14 10:40:18 HTTP/cdh1@JAVACHEN.COM (aes256-cts-hmac-sha1-96)
   2 11/13/14 10:40:18 HTTP/cdh1@JAVACHEN.COM (aes128-cts-hmac-sha1-96)
   2 11/13/14 10:40:18 HTTP/cdh1@JAVACHEN.COM (des3-cbc-sha1)
   2 11/13/14 10:40:18 HTTP/cdh1@JAVACHEN.COM (arcfour-hmac)
   2 11/13/14 10:40:18 HTTP/cdh1@JAVACHEN.COM (des-hmac-sha1)
   2 11/13/14 10:40:18 HTTP/cdh1@JAVACHEN.COM (des-cbc-md5)
   2 11/13/14 10:40:18 HTTP/cdh2@JAVACHEN.COM (aes256-cts-hmac-sha1-96)
   2 11/13/14 10:40:18 HTTP/cdh2@JAVACHEN.COM (aes128-cts-hmac-sha1-96)
   2 11/13/14 10:40:18 HTTP/cdh2@JAVACHEN.COM (des3-cbc-sha1)
   2 11/13/14 10:40:18 HTTP/cdh2@JAVACHEN.COM (arcfour-hmac)
   2 11/13/14 10:40:18 HTTP/cdh2@JAVACHEN.COM (des-hmac-sha1)
   2 11/13/14 10:40:18 HTTP/cdh2@JAVACHEN.COM (des-cbc-md5)
   2 11/13/14 10:40:18 HTTP/cdh3@JAVACHEN.COM (aes256-cts-hmac-sha1-96)
   2 11/13/14 10:40:18 HTTP/cdh3@JAVACHEN.COM (aes128-cts-hmac-sha1-96)
   2 11/13/14 10:40:18 HTTP/cdh3@JAVACHEN.COM (des3-cbc-sha1)
   2 11/13/14 10:40:18 HTTP/cdh3@JAVACHEN.COM (arcfour-hmac)
   2 11/13/14 10:40:18 HTTP/cdh3@JAVACHEN.COM (des-hmac-sha1)
   2 11/13/14 10:40:18 HTTP/cdh3@JAVACHEN.COM (des-cbc-md5)
</code></pre>

<p>验证是否正确合并了key，使用合并后的keytab，分别使用hdfs和host principals来获取证书。</p>

<pre><code class="language-bash">$ kinit -k -t hdfs.keytab hdfs/cdh1@JAVACHEN.COM
$ kinit -k -t hdfs.keytab HTTP/cdh1@JAVACHEN.COM
</code></pre>

<p>如果出现错误：<code>kinit: Key table entry not found while getting initial credentials</code>，<br />
则上面的合并有问题，重新执行前面的操作。</p>

<h2 id="kerberos-keytab">10.3 部署kerberos keytab文件</h2>

<p>拷贝 hdfs.keytab 文件到其他节点的 /etc/hadoop/conf 目录</p>

<pre><code class="language-bash">$ cd /var/kerberos/krb5kdc/

$ scp hdfs.keytab cdh1:/etc/hadoop/conf
$ scp hdfs.keytab cdh2:/etc/hadoop/conf
$ scp hdfs.keytab cdh3:/etc/hadoop/conf
</code></pre>

<p>并设置权限，分别在 cdh1、cdh2、cdh3 上执行：</p>

<pre><code class="language-bash">$ ssh cdh1 "chown hdfs:hadoop /etc/hadoop/conf/hdfs.keytab ;chmod 400 /etc/hadoop/conf/hdfs.keytab"
$ ssh cdh2 "chown hdfs:hadoop /etc/hadoop/conf/hdfs.keytab ;chmod 400 /etc/hadoop/conf/hdfs.keytab"
$ ssh cdh3 "chown hdfs:hadoop /etc/hadoop/conf/hdfs.keytab ;chmod 400 /etc/hadoop/conf/hdfs.keytab"
</code></pre>

<p>由于 keytab 相当于有了永久凭证，不需要提供密码(如果修改kdc中的principal的密码，则该keytab就会失效)，所以其他用户如果对该文件有读权限，就可以冒充 keytab 中指定的用户身份访问 hadoop，所以 keytab 文件需要确保只对 owner 有读权限(0400)</p>

<h2 id="hdfs-">10.4 修改 hdfs 配置文件</h2>

<p>先停止集群：</p>

<pre><code class="language-bash">$ for x in `cd /etc/init.d ; ls hive-*` ; do sudo service $x stop ; done
$ for x in `cd /etc/init.d ; ls impala-*` ; do sudo service $x stop ; done
$ for x in `cd /etc/init.d ; ls hadoop-*` ; do sudo service $x stop ; done
$ for x in `cd /etc/init.d ; ls zookeeper-*` ; do sudo service $x stop ; done
</code></pre>

<p>在集群中所有节点的 core-site.xml 文件中添加下面的配置:</p>

<pre><code class="language-xml">&lt;property&gt;
  &lt;name&gt;hadoop.security.authentication&lt;/name&gt;
  &lt;value&gt;kerberos&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;hadoop.security.authorization&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
</code></pre>

<p>在集群中所有节点的 hdfs-site.xml 文件中添加下面的配置：</p>

<pre><code class="language-xml">&lt;property&gt;
  &lt;name&gt;dfs.block.access.token.enable&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;  
  &lt;name&gt;dfs.datanode.data.dir.perm&lt;/name&gt;  
  &lt;value&gt;700&lt;/value&gt;  
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;dfs.namenode.keytab.file&lt;/name&gt;
  &lt;value&gt;/etc/hadoop/conf/hdfs.keytab&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;dfs.namenode.kerberos.principal&lt;/name&gt;
  &lt;value&gt;hdfs/_HOST@JAVACHEN.COM&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;dfs.namenode.kerberos.https.principal&lt;/name&gt;
  &lt;value&gt;HTTP/_HOST@JAVACHEN.COM&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;dfs.datanode.address&lt;/name&gt;
  &lt;value&gt;0.0.0.0:1004&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;dfs.datanode.http.address&lt;/name&gt;
  &lt;value&gt;0.0.0.0:1006&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;dfs.datanode.keytab.file&lt;/name&gt;
  &lt;value&gt;/etc/hadoop/conf/hdfs.keytab&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;dfs.datanode.kerberos.principal&lt;/name&gt;
  &lt;value&gt;hdfs/_HOST@JAVACHEN.COM&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;dfs.datanode.kerberos.https.principal&lt;/name&gt;
  &lt;value&gt;HTTP/_HOST@JAVACHEN.COM&lt;/value&gt;
&lt;/property&gt;
</code></pre>

<p>如果想开启 SSL，请添加（本文不对这部分做说明）：</p>

<pre><code class="language-xml">&lt;property&gt;
  &lt;name&gt;dfs.http.policy&lt;/name&gt;
  &lt;value&gt;HTTPS_ONLY&lt;/value&gt;
&lt;/property&gt;
</code></pre>

<p>如果 HDFS 配置了 QJM HA，则需要添加（另外，你还要在 zookeeper 上配置 kerberos）：</p>

<pre><code class="language-xml">&lt;property&gt;
  &lt;name&gt;dfs.journalnode.keytab.file&lt;/name&gt;
  &lt;value&gt;/etc/hadoop/conf/hdfs.keytab&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;dfs.journalnode.kerberos.principal&lt;/name&gt;
  &lt;value&gt;hdfs/_HOST@JAVACHEN.COM&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;dfs.journalnode.kerberos.internal.spnego.principal&lt;/name&gt;
  &lt;value&gt;HTTP/_HOST@JAVACHEN.COM&lt;/value&gt;
&lt;/property&gt;
</code></pre>

<p>如果配置了 WebHDFS，则添加：</p>

<pre><code class="language-xml">&lt;property&gt;
  &lt;name&gt;dfs.webhdfs.enabled&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;dfs.web.authentication.kerberos.principal&lt;/name&gt;
  &lt;value&gt;HTTP/_HOST@JAVACHEN.COM&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;dfs.web.authentication.kerberos.keytab&lt;/name&gt;
  &lt;value&gt;/etc/hadoop/conf/hdfs.keytab&lt;/value&gt;
&lt;/property&gt;
</code></pre>

<p>配置中有几点要注意的：</p>

<ul>
  <li>
    <ol>
      <li><code>dfs.datanode.address</code>表示 data transceiver RPC server 所绑定的 hostname 或 IP 地址，如果开启 security，端口号必须小于 <code>1024</code>(privileged port)，否则的话启动 datanode 时候会报 <code>Cannot start secure cluster without privileged resources</code> 错误</li>
    </ol>
  </li>
  <li>
    <ol>
      <li>principal 中的 instance 部分可以使用 <code>_HOST</code> 标记，系统会自动替换它为全称域名</li>
    </ol>
  </li>
  <li>
    <ol>
      <li>如果开启了 security, hadoop 会对 hdfs block data(由 <code>dfs.data.dir</code> 指定)做 permission check，方式用户的代码不是调用hdfs api而是直接本地读block data，这样就绕过了kerberos和文件权限验证，管理员可以通过设置 <code>dfs.datanode.data.dir.perm</code> 来修改 datanode 文件权限，这里我们设置为700</li>
    </ol>
  </li>
</ul>

<h2 id="hdfs--1">10.5 检查集群上的 HDFS 和本地文件的权限</h2>

<p>请参考 <a href="http://www.cloudera.com/content/cloudera/en/documentation/core/latest/topics/cdh_sg_users_groups_verify.html">Verify User Accounts and Groups in CDH 5 Due to Security</a> 或者 <a href="http://hadoop.apache.org/docs/r2.5.0/hadoop-project-dist/hadoop-common/SecureMode.html">Hadoop in Secure Mode</a>。</p>

<h2 id="namenode">10.6 启动 NameNode</h2>

<p>启动之前，请确认 JCE jar 已经替换，请参考前面的说明。</p>

<p>在每个节点上获取 root 用户的 ticket，这里 root 为之前创建的 root/admin 的密码。</p>

<pre><code class="language-bash">$ ssh cdh1 "echo root|kinit root/admin"
$ ssh cdh1 "echo root|kinit root/admin"
$ ssh cdh1 "echo root|kinit root/admin"
</code></pre>

<p>获取 cdh1的 ticket：</p>

<pre><code class="language-bash">$ kinit -k -t /etc/hadoop/conf/hdfs.keytab hdfs/cdh1@JAVACHEN.COM
</code></pre>

<p>如果出现下面异常 <code>kinit: Password incorrect while getting initial credentials</code>，则重新导出 keytab 再试试。</p>

<p>然后启动服务，观察日志：</p>

<pre><code class="language-bash">$ /etc/init.d/hadoop-hdfs-namenode start
</code></pre>

<p>验证 NameNode 是否启动，一是打开 web 界面查看启动状态，一是运行下面命令查看 hdfs：</p>

<pre><code class="language-bash">$ hadoop fs -ls /
Found 4 items
drwxrwxrwx   - yarn hadoop          0 2014-06-26 15:24 /logroot
drwxrwxrwt   - hdfs hadoop          0 2014-11-04 10:44 /tmp
drwxr-xr-x   - hdfs hadoop          0 2014-08-10 10:53 /user
drwxr-xr-x   - hdfs hadoop          0 2013-05-20 22:52 /var
</code></pre>

<p>如果在你的凭据缓存中没有有效的 kerberos ticket，执行上面命令将会失败，将会出现下面的错误：</p>

<pre><code>14/11/04 12:08:12 WARN ipc.Client: Exception encountered while connecting to the server : javax.security.sasl.SaslException:
GSS initiate failed [Caused by GS***ception: No valid credentials provided (Mechanism level: Failed to find any Kerberos tgt)]
Bad connection to FS. command aborted. exception: Call to cdh1/192.168.56.121:8020 failed on local exception: java.io.IOException:
javax.security.sasl.SaslException: GSS initiate failed [Caused by GS***ception: No valid credentials provided (Mechanism level: Failed to find any Kerberos tgt)]
</code></pre>

<h2 id="datanode">10.7 启动DataNode</h2>

<p>DataNode 需要通过 JSVC 启动。首先检查是否安装了 JSVC 命令，然后配置环境变量。</p>

<p>在 cdh1 节点查看是否安装了 JSVC：</p>

<pre><code class="language-bash">$ ls /usr/lib/bigtop-utils/
bigtop-detect-classpath  bigtop-detect-javahome  bigtop-detect-javalibs  jsvc
</code></pre>

<p>然后编辑 <code>/etc/default/hadoop-hdfs-datanode</code>，取消对下面的注释并添加一行设置 <code>JSVC_HOME</code>，修改如下：</p>

<pre><code class="language-bash">export HADOOP_SECURE_DN_USER=hdfs
export HADOOP_SECURE_DN_PID_DIR=/var/run/hadoop-hdfs
export HADOOP_SECURE_DN_LOG_DIR=/var/log/hadoop-hdfs

export JSVC_HOME=/usr/lib/bigtop-utils
</code></pre>

<p>将该文件同步到其他节点：</p>

<pre><code class="language-bash">$ scp /etc/default/hadoop-hdfs-datanode cdh2:/etc/default/hadoop-hdfs-datanode
$ scp /etc/default/hadoop-hdfs-datanode cdh3:/etc/default/hadoop-hdfs-datanode
</code></pre>

<p>分别在 cdh2、cdh3 获取 ticket 然后启动服务：</p>

<pre><code class="language-bash">#root 为 root/admin 的密码
$ ssh cdh1 "kinit -k -t /etc/hadoop/conf/hdfs.keytab hdfs/cdh1@JAVACHEN.COM; service hadoop-hdfs-datanode start"
$ ssh cdh2 "kinit -k -t /etc/hadoop/conf/hdfs.keytab hdfs/cdh2@JAVACHEN.COM; service hadoop-hdfs-datanode start"
$ ssh cdh3 "kinit -k -t /etc/hadoop/conf/hdfs.keytab hdfs/cdh3@JAVACHEN.COM; service hadoop-hdfs-datanode start"
</code></pre>

<p>观看 cdh1 上 NameNode 日志，出现下面日志表示 DataNode 启动成功：</p>

<pre><code>14/11/04 17:21:41 INFO security.UserGroupInformation:
Login successful for user hdfs/cdh2@JAVACHEN.COM using keytab file /etc/hadoop/conf/hdfs.keytab
</code></pre>

<h1 id="section-7">11. 总结</h1>

<p>本文介绍了 CDH Hadoop 集成 kerberos 认证的过程，其中主要需要注意以下几点：</p>

<ul>
  <li>
    <ol>
      <li>配置 hosts，<code>hostname</code> 请使用小写</li>
    </ol>
  </li>
  <li>
    <ol>
      <li>确保 kerberos 客户端和服务端连通</li>
    </ol>
  </li>
  <li>
    <ol>
      <li>替换 JRE 自带的 JCE jar 包</li>
    </ol>
  </li>
  <li>
    <ol>
      <li>为 DataNode 设置运行用户并配置 <code>JSVC_HOME</code></li>
    </ol>
  </li>
  <li>
    <ol>
      <li>启动服务前，先获取 ticket 再运行相关命令</li>
    </ol>
  </li>
</ul>

<p>上面的过程比较繁琐，我总结了上面的过程并写了一些自动化的脚本方便快速安装、配置以及管理 kerberos，请参考<a href="/2014/11/25/quikstart-for-config-kerberos-ldap-and-sentry-in-hadoop.html">Hadoop集群部署权限总结</a>。</p>

<h1 id="section-8">12. 参考文章</h1>

<ul>
  <li><a href="http://blog.cloudera.com/blog/2015/03/how-to-quickly-configure-kerberos-for-your-apache-hadoop-cluster/">How-to: Quickly Configure Kerberos for Your Apache Hadoop Cluster</a></li>
  <li><a href="https://github.com/zouhc/MyHadoop/blob/master/doc/Hadoop%E7%9A%84kerberos%E7%9A%84%E5%AE%9E%E8%B7%B5%E9%83%A8%E7%BD%B2.md">Hadoop的kerberos的实践部署</a></li>
  <li><a href="http://blog.chinaunix.net/uid-1838361-id-3243243.html">hadoop 添加kerberos认证</a></li>
  <li><a href="http://blog.csdn.net/lalaguozhe/article/details/11570009">YARN &amp; HDFS2 安装和配置Kerberos</a></li>
  <li><a href="http://blog.godatadriven.com/kerberos_kdc_install.html">Kerberos basics and installing a KDC</a></li>
  <li><a href="http://www.wuzesheng.com/?p=2345">Hadoop, Hbase, Zookeeper安全实践</a></li>
</ul>


                    <br/>
                    <div class="well">
                        原创文章，转载请注明： 转载自<a href="http://blog.javachen.com">JavaChen Blog</a>，作者：<a href="http://blog.javachen.com/about.html">yuke</a><br/>
                        本文链接地址：<a href="/2014/11/04/config-kerberos-in-cdh-hdfs.html">http://blog.javachen.com/2014/11/04/config-kerberos-in-cdh-hdfs.html</a><br/>
                        本文基于<a target="_blank" title="Creative Commons Attribution 2.5 China Mainland License" href="http://creativecommons.org/licenses/by/2.5/cn/">署名2.5中国大陆许可协议</a>发布，欢迎转载、演绎或用于商业目的，但是必须保留本文署名和文章链接。
                        如您有任何疑问或者授权方面的协商，请邮件联系我</a>。
                    </div>
                    <div class="col-md-6">
                      <p class="text-success hidden-print"><i class="fa fa-external-link"></i> <a href="/2014/11/04/config-kerberos-in-cdh-hdfs.html">HDFS配置Kerberos认证</a></p>
                    </div>
                    <div class="col-md-6">
                       <p class="meta hidden-print pull-right">
                        
                            <i class="fa fa-folder-open"></i>
                            
                            <a class="btn btn-default btn-sm" href="/categories.html#hadoop">hadoop</a>
                          
                        
                        
                            <i class="fa fa-tags"></i>
                            
                            <a class="btn btn-default btn-sm" href="/tags.html#hadoop">hadoop</a>
                          
                            <a class="btn btn-default btn-sm" href="/tags.html#kerberos">kerberos</a>
                          
                            <a class="btn btn-default btn-sm" href="/tags.html#cdh">cdh</a>
                          
                        </p>
                    </div>
               </div><!--#post-text-->
          </div><!--#post-->
      </div> <!--#content-->

      <div id="post-comment" class="hidden-print">
      
<div id="comments">
  <div class="ds-thread" data-thread-key="/2014/11/04/config-kerberos-in-cdh-hdfs.html" data-url="http://blog.javachen.com/2014/11/04/config-kerberos-in-cdh-hdfs.html" data-title="HDFS配置Kerberos认证"></div>
</div>



      </div>


          </div>
          <a href="#" class="btn back-to-top btn-dark btn-fixed-bottom hidden-print"><i class="fa fa-chevron-up"></i></a>
      </div>
      <div id="footer">
          <div class="container hidden-print">
              <p class="text-center"><i class="fa fa-copyright"></i> 2015 JavaChen Blog. Theme designed by <a href="/about.html" target="_blank" title="">yuke</a> with <a href="https://github.com/mojombo/jekyll/">Jekyll</a>, <a href="http://twitter.github.com/bootstrap/">Bootstrap</a> and <a href="http://fortawesome.github.com/Font-Awesome/">Font Awesome</a>.
  	            
            <script type="text/javascript">
                var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
                document.write(unescape("%3Cspan id='cnzz_stat_icon_1256628929'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/z_stat.php%3Fid%3D1256628929' type='text/javascript'%3E%3C/script%3E"));</script>
            
            
    </p>
          </div>
      </div>

      <script type="text/javascript" src="/static/contrib/jquery/jquery.min.js"></script>
      <script type="text/javascript" src="/static/contrib/bootstrap/js/bootstrap.min.js"></script>
      <script type="text/javascript" src="/static/contrib/qrcode/jquery.qrcode.min.js"></script>
      <script type="text/javascript" src="/static/contrib/showup/showup.js"></script>
      <script type="text/javascript" src="/static/js/core.js"></script>
      
      <script type="text/javascript">
      var duoshuoQuery = {short_name:"javachen"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = 'http://static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] ||
        document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
      

      <script type="text/javascript">
      $('#qr').qrcode({
          width: 128,
          height: 128,
          text: 'http://blog.javachen.com/2014/11/04/config-kerberos-in-cdh-hdfs.html'
      });
      </script>
  </body>
</html>
