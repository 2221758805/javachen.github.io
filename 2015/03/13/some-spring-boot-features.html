<!DOCTYPE html>
<html lang="zh-cn">
        <head>
      <meta charset="utf-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
      <title>Spring Boot特性 - JavaChen Blog</title>
      <meta name="author" content="JavaChen"/>
      <meta name="description" content="记录 Spring Boot 的一些特性以及如何对这些特性进行自定义配置。">
      <meta name="keywords" content="java,spring,spring mvc,spring boot,mybatis,hibernate,jdbc,hadoop,hive,mapreduce,hbase,hdfs,spark,yarn,impala,presto,impala,sentry,zookeeper,pentaho,kettle,solr,scala,python,javascript,angular,jquery,postgresql">
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
      <link rel="canonical" href="http://blog.javachen.com/2015/03/13/some-spring-boot-features.html" />

      <link rel="stylesheet" href="/static/contrib/bootstrap/css/bootstrap.min.css" media="all" />
      <link rel="stylesheet" href="/static/css/style.css" media="all" />
      <link rel="stylesheet" href="/static/css/pygments.css" media="all" />
      <link rel="stylesheet" href="/static/contrib/font-awesome/css/font-awesome.min.css" media="all" />
      <link rel="stylesheet" type="text/css" href="/static/contrib/showup/showup.css" />

        <!-- fav and touch icons  -->
        <!-- Update these with your own images
        <link rel="shortcut icon" href="images/favicon.ico">
        <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
        -->

      <meta name="renderer" content="webkit|ie-stand">
      <meta name="baidu-site-verification" content="3HAhaWRiyR" />
      <meta name="360-site-verification" content="9b7a87a1d52051c96644f0a9b8b79898" />
      <meta name="sogou_site_verification" content="ofwXWFdthV"/>
      <meta property="wb:webmaster" content="b6081b2b8ab84c60" />
    </head>

    <body>
      <!--[if lte IE 9]>
<div class="alert alert-warning">
  <p>Your Internet Explorer is not supported. Please upgrade your Internet Explorer to version 9+, or use latest <a href="http://www.google.com/chrome/" target="_blank" class="alert-link">Google chrome</a>、<a href="http://www.mozilla.org/firefox/" target="_blank" class="alert-link">Mozilla Firefox</a>.</p>
  <p>If you are using IE 9 or later, make sure you <a href="http://windows.microsoft.com/en-us/internet-explorer/use-compatibility-view#ie=ie-8" target="_blank" class="alert-link">turn off "Compatibility view"</a>.</p>
</div>
<![endif]-->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">JavaChen Blog</a>
        </div>
        <div class="navbar-collapse collapse">
            <form id="search-form" class="form-group navbar-form navbar-right" role="search">
                  <div class="form-group">
                    <input type="text" name="q" value=""  id="query" class="form-control" placeholder="搜索" required autocomplete="off" ></input>
                    <input type="submit" class="btn btn-default" value=" Go" ></input>
                  </div>
              </form>
            <ul class="nav navbar-nav">
              <li><a href="/archive.html" title="Archive"><span class='fa fa-archive fa-2x'></span></a></li>
              <li><a href="/categories.html" title="Categories"><span class='fa fa-navicon fa-2x'></span></a></li>
              <li><a href="/tags.html" title="Tags"><span class='fa fa-tags fa-2x'></span></a></li>
              <li><a href="/about.html" title="About"><span class='fa fa-user fa-2x'></span></a></li>
              
              <li><a href="https://github.com/javachen" target="_blank" title="Github"><span class='fa fa-github fa-2x'></span></a></li>
              
              
              
              
              
              <li><a href="http://weibo.com/chenzhijun" target="_blank" title="Weibo"><span class="fa fa-weibo fa-2x"></span></a></li>
              
              <li><a href="/rss.xml" target="_blank" title="RSS"><span class='fa fa-rss fa-2x'></span></a></li>
            </ul>
        </div>

        </div><!--/.nav-collapse -->
      </div>
</div>

      <div id="wrap">
          <div class="container">
                 <div id="content">
          <ul class="pager hidden-print">
               
                <li class="previous"><a href="/2015/03/13/how-to-run-spring-boot-application.html" title="如何运行Spring Boot应用"><i class="fa fa-angle-double-left"></i>&nbsp;如何运行Spring Boot应用</a></li>
                
                
                <li class="next"><a href="/2015/03/17/install-and-test-kafka.html" title="安装和测试Kafka">安装和测试Kafka&nbsp;<i class="fa fa-angle-double-right"></i></a></li>
                
          </ul>

           <div id="post" class="clearfix">
              <div id="post-title" class="page-header text-center">
                  <h1> Spring Boot特性  </h1>
              </div>
              <p class="text-muted clearfix">
                  <span class="pull-right">2015.03.13 | <a href="#comments">Comments</a></span>
              </p>
              <div id="qr" class="qrcode visible-lg"></div>

              <div id="post-text">
                    <h1 id="springapplication">1. SpringApplication</h1>

<p>SpringApplication 类是启动 Spring Boot 应用的入口类，你可以创建一个包含 <code class="highlighter-rouge">main()</code> 方法的类，来运行 <code class="highlighter-rouge">SpringApplication.run</code> 这个静态方法：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>public static void main(String[] args) {
    SpringApplication.run(MySpringConfiguration.class, args);
}
</code></pre>
</div>

<p>运行该类会有如下输出：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::   v1.2.2.RELEASE
</code></pre>
</div>

<h2 id="banner">1.1 自定义Banner</h2>

<p>通过在classpath下添加一个banner.txt或设置banner.location来指定相应的文件可以改变启动过程中打印的banner。如果这个文件有特殊的编码，你可以使用banner.encoding设置它（默认为UTF-8）。</p>

<p>在banner.txt中可以使用如下的变量：</p>

<ul>
  <li><code class="highlighter-rouge">${application.version}</code>：MANIFEST.MF 文件中的应用版本号</li>
  <li><code class="highlighter-rouge">${application.formatted-version}</code></li>
  <li><code class="highlighter-rouge">${spring-boot.version}</code>：你正在使用的 Spring Boot 版本号</li>
  <li><code class="highlighter-rouge">${spring-boot.formatted-version}</code></li>
</ul>

<p>上面这些变量也可以通过 application.properties  来设置，后面再作介绍。</p>

<p>注：如果想以编程的方式产生一个banner，可以使用SpringBootApplication.setBanner(…)方法。使用org.springframework.boot.Banner接口，实现你自己的printBanner()方法。</p>

<h2 id="springapplication-1">1.2 自定义SpringApplication</h2>

<p>如果默认的SpringApplication不符合你的口味，你可以创建一个本地的实例并自定义它。例如，关闭banner你可以这样写：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">SpringApplication</span> <span class="n">app</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringApplication</span><span class="o">(</span><span class="n">MySpringConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">app</span><span class="o">.</span><span class="na">setShowBanner</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="n">app</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="api">1.3 流畅的构建API</h2>

<p>如果你需要创建一个分层的ApplicationContext（多个具有父子关系的上下文），或你只是喜欢使用流畅的构建API，你可以使用SpringApplicationBuilder。SpringApplicationBuilder允许你以链式方式调用多个方法，包括可以创建层次结构的parent和child方法。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">new</span> <span class="nf">SpringApplicationBuilder</span><span class="p">(</span><span class="o">)</span>
    <span class="o">.</span><span class="na">showBanner</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
    <span class="o">.</span><span class="na">sources</span><span class="o">(</span><span class="n">Parent</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">child</span><span class="o">(</span><span class="n">Application</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
</code></pre>
</div>

<h2 id="application">1.4 Application事件和监听器</h2>

<p>SpringApplication 启动过程会触发一些事件，你可以针对这些事件通过 <code class="highlighter-rouge">SpringApplication.addListeners(…​)</code> 添加一些监听器:</p>

<ul>
  <li>ApplicationStartedEvent</li>
  <li>ApplicationEnvironmentPreparedEvent</li>
  <li>ApplicationPreparedEvent</li>
  <li>ApplicationFailedEvent</li>
</ul>

<p>SpringApplication 会注册一个 shutdown hook 以便在应用退出的时候能够保证 <code class="highlighter-rouge">ApplicationContext</code> 优雅地关闭，这样能够保证所有 Spring lifecycle 的回调都会被执行，包括 DisposableBean 接口的实现类以及 <code class="highlighter-rouge">@PreDestroy</code> 注解。</p>

<p>另外，你也可以实现 <code class="highlighter-rouge">org.springframework.boot.ExitCodeGenerator</code> 接口来定义你自己的退出时候的逻辑。</p>

<h2 id="web">1.5 Web环境</h2>

<p>一个<code class="highlighter-rouge">SpringApplication</code>将尝试为你创建正确类型的<code class="highlighter-rouge">ApplicationContext</code>。在默认情况下，使用<code class="highlighter-rouge">AnnotationConfigApplicationContext</code>或<code class="highlighter-rouge">AnnotationConfigEmbeddedWebApplicationContext</code>取决于你正在开发的是否是web应用。</p>

<p>用于确定一个web环境的算法相当简单（基于是否存在某些类）。如果需要覆盖默认行为，你可以使用<code class="highlighter-rouge">setWebEnvironment(boolean webEnvironment)</code>。通过调用<code class="highlighter-rouge">setApplicationContextClass(…)</code>，你可以完全控制ApplicationContext的类型。</p>

<p>注：当JUnit测试里使用SpringApplication时，调用<code class="highlighter-rouge">setWebEnvironment(false)</code>是可取的。</p>

<h2 id="section">1.6 获取应用参数</h2>

<p>如果你想获取应用程序传递给<code class="highlighter-rouge">SpringApplication.run(…​)</code>的参数，你可以注入一个<code class="highlighter-rouge">org.springframework.boot.ApplicationArguments</code>bean，ApplicationArguments这个接口提供了方法获取可选的和非可选的String[]类型的参数。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.boot.*</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.*</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.*</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBean</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="n">MyBean</span><span class="o">(</span><span class="n">ApplicationArguments</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">debug</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="na">containsOption</span><span class="o">(</span><span class="s">"debug"</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">files</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="na">getNonOptionArgs</span><span class="o">();</span>
        <span class="c1">// if run with "--debug logfile.txt" debug=true, files=["logfile.txt"]</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<blockquote>
  <p>Spring Boot也会在<code class="highlighter-rouge">Environment</code>中注入一个<code class="highlighter-rouge">CommandLinePropertySource</code>，这允许你使用<code class="highlighter-rouge">@Value</code>注解注入一个应用参数。</p>
</blockquote>

<h2 id="applicationrunnercommandlinerunner">1.7 使用ApplicationRunner或者CommandLineRunner</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.boot.*</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.*</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBean</span> <span class="kd">implements</span> <span class="n">CommandLineRunner</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="n">run</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Do something...</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<p>如果一些CommandLineRunner或者ApplicationRunner beans被定义必须以特定的次序调用，你可以额外实现<code class="highlighter-rouge">org.springframework.core.Ordered</code>接口或使用<code class="highlighter-rouge">@Order</code>注解。</p>

<h2 id="section-1">1.8 程序退出</h2>

<p><code class="highlighter-rouge">SpringApplication</code>会在JVM上注册一个关闭的hook已确认ApplicationContext是否优雅的关闭。所有的标准的Spring生命周期回调（例如，<code class="highlighter-rouge">DisposableBean</code>接口，或者<code class="highlighter-rouge">@PreDestroy</code>注解）都可以使用。</p>

<p>另外，beans可以实现org.springframework.boot.ExitCodeGenerator接口在应用程序结束的时候返回一个错误码。</p>

<h2 id="section-2">1.9 管理员特性</h2>

<p>通过<code class="highlighter-rouge">spring.application.admin.enabled</code>开启。</p>

<h1 id="section-3">2. 外化配置</h1>

<p>Spring Boot允许你针对不同的环境配置不同的配置参数，你可以使用 properties文件、YAML 文件、环境变量或者命令行参数来修改应用的配置。你可以在代码中使用@Value注解来获取配置参数的值。</p>

<p>Spring Boot使用一个特别的<code class="highlighter-rouge">PropertySource</code>来按顺序加载配置，加载顺序如下：</p>

<ul>
  <li>命令行参数</li>
  <li>来自<code class="highlighter-rouge">SPRING_APPLICATION_JSON</code>的属性</li>
  <li><code class="highlighter-rouge">java:comp/env</code> 中的 JNDI 属性</li>
  <li>Java系统环境变量</li>
  <li>操作系统环境变量</li>
  <li><code class="highlighter-rouge">RandomValuePropertySource</code>，随机值，使用 <code class="highlighter-rouge">random.*</code> 来定义</li>
  <li>jar 包外的 Profile 配置文件，如 application-{profile}.properties 和 YAML 文件</li>
  <li>jar 包内的 Profile 配置文件，如 application-{profile}.properties 和 YAML 文件</li>
  <li>jar 包外的 Application 配置，如 application.properties 和 application.yml 文件</li>
  <li>jar 包内的 Application 配置，如 application.properties 和 application.yml 文件</li>
  <li>在标有 @Configuration 注解的类标有@PropertySource注解的</li>
  <li>默认值，使用 <code class="highlighter-rouge">SpringApplication.setDefaultProperties</code> 设置的</li>
</ul>

<p>示例代码：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.stereotype.*</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.*</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBean</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${name}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre>
</div>

<p>你可以在 <code class="highlighter-rouge">application.properties</code> 中定义一个 name 变量，或者在运行该 jar 时候，指定一个命令行参数（以 <code class="highlighter-rouge">--</code> 标识），例如：<code class="highlighter-rouge">java -jar app.jar --name="Spring"</code></p>

<p>也可以使用<code class="highlighter-rouge">SPRING_APPLICATION_JSON</code>属性：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nv">SPRING_APPLICATION_JSON</span><span class="o">=</span><span class="s1">'{"foo":{"bar":"spam"}}'</span> 
<span class="gp">$ </span>java -jar myapp.jar
</code></pre>
</div>

<p>在这个例子中，你可以在Spring的<code class="highlighter-rouge">Environment</code>中通过foo.bar来引用变量。你可以在系统变量中定义<code class="highlighter-rouge">pring.application.json</code>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>java -Dspring.application.json<span class="o">=</span><span class="s1">'{"foo":"bar"}'</span> -jar myapp.jar
</code></pre>
</div>

<p>或者使用命令行参数：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>java -jar myapp.jar --spring.application.json<span class="o">=</span><span class="s1">'{"foo":"bar"}'</span>
</code></pre>
</div>

<p>或者使用JNDI变量：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>java:comp/env/spring.application.json
</code></pre>
</div>

<h2 id="section-4">2.1 随机变量</h2>

<p>RandomValuePropertySource 类型变量的示例如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="py">my.secret</span><span class="p">=</span><span class="s">${random.value}</span>
<span class="py">my.number</span><span class="p">=</span><span class="s">${random.int}</span>
<span class="py">my.bignumber</span><span class="p">=</span><span class="s">${random.long}</span>
<span class="py">my.number.less.than.ten</span><span class="p">=</span><span class="s">${random.int(10)}</span>
<span class="py">my.number.in.range</span><span class="p">=</span><span class="s">${random.int[1024,65536]}</span>
</code></pre>
</div>

<h2 id="section-5">2.3 应用属性文件</h2>

<p>SpringApplication 会在以下路径查找 <code class="highlighter-rouge">application.properties</code> 并加载该文件：</p>

<ul>
  <li><code class="highlighter-rouge">/config</code> 目录下</li>
  <li>当前目录</li>
  <li>classpath 中 <code class="highlighter-rouge">/config</code> 包下</li>
  <li>classpath 根路径下</li>
</ul>

<p>另外，你也可以通过 <code class="highlighter-rouge">spring.config.location</code> 来指定 <code class="highlighter-rouge">application.properties</code> 文件的存放路径，或者通过 <code class="highlighter-rouge">spring.config.name</code> 指定该文件的名称，例如：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>java -jar myproject.jar --spring.config.location<span class="o">=</span>classpath:/default.properties,classpath:/override.properties
</code></pre>
</div>

<p>或者：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>java -jar myproject.jar --spring.config.name<span class="o">=</span>myproject
</code></pre>
</div>

<h2 id="profile">2.4 指定Profile配置文件</h2>

<p>即<code class="highlighter-rouge">application-{profile}.properties</code>配置文件。</p>

<h2 id="section-6">2.5 占位符</h2>

<p>在<code class="highlighter-rouge">application.properties</code>文件中可以引用<code class="highlighter-rouge">Environment</code>中已经存在的变量。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="py">app.name</span><span class="p">=</span><span class="s">MyApp</span>
<span class="py">app.description</span><span class="p">=</span><span class="s">${app.name} is a Spring Boot application</span>
</code></pre>
</div>

<h1 id="profiles">3. Profiles</h1>

<p>你可以使用 <code class="highlighter-rouge">@Profile</code> 注解来标注应用使用的环境</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@Profile</span><span class="o">(</span><span class="s">"production"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductionConfiguration</span> <span class="o">{</span>

    <span class="c1">// ...</span>

<span class="o">}</span>
</code></pre>
</div>

<p>可以使用 <code class="highlighter-rouge">spring.profiles.active</code> 变量来定义应用激活的 profile：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="py">spring.profiles.active</span><span class="p">=</span><span class="s">dev,hsqldb</span>
</code></pre>
</div>

<p>还可以通过  SpringApplication 来设置，调用 <code class="highlighter-rouge">SpringApplication.setAdditionalProfiles(…​)</code> 代码即可。</p>

<h1 id="section-7">4. 日志</h1>

<p>Spring Boot 使用 Commons Logging 作为内部记录日志，你也可以使用 Java Util Logging, Log4J, Log4J2 和 Logback 来记录日志。</p>

<p>默认情况下，如果你使用了 Starter POMs ，则会使用 Logback 来记录日志。</p>

<p>默认情况，是输出 INFO 类型的日志，你可以通过设置命令行参数<code class="highlighter-rouge">--debug</code>来设置：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>java -jar myapp.jar --debug
</code></pre>
</div>

<p>如果你的终端支持 ANSI ，则日志支持彩色输出，这个可以通过 <code class="highlighter-rouge">spring.output.ansi.enabled</code> 设置，可配置的值有：<code class="highlighter-rouge">ALWAYS</code>、<code class="highlighter-rouge">DETECT</code>、<code class="highlighter-rouge">NEVER</code>。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>%clr<span class="o">(</span>%d<span class="o">{</span>yyyy-MM-dd HH:mm:ss.SSS<span class="o">}){</span>yellow<span class="o">}</span>
</code></pre>
</div>

<p>可选的颜色有：</p>

<ul>
  <li>blue</li>
  <li>cyan</li>
  <li>faint</li>
  <li>green</li>
  <li>magenta</li>
  <li>red</li>
  <li>yellow</li>
</ul>

<p>可以通过 <code class="highlighter-rouge">logging.file</code> 和 <code class="highlighter-rouge">logging.path</code> 设置日志输出文件名称和路径。</p>

<p>日志级别使用 <code class="highlighter-rouge">logging.level.*=LEVEL</code> 来定义，例如：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="py">logging.level.org.springframework.web</span><span class="p">:</span> <span class="s">DEBUG</span>
<span class="py">logging.level.org.hibernate</span><span class="p">:</span> <span class="s">ERROR</span>
</code></pre>
</div>

<p>Spring Boot 通过 <code class="highlighter-rouge">logging.config</code> 来定义日志的配置文件存放路径，对于不同的日志系统，配置文件的名称不同：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Logging</th>
      <th style="text-align: left">System   Customization</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Logback</td>
      <td style="text-align: left">logback-spring.xml、logback-spring.groovy、logback.xml 、 logback.groovy</td>
    </tr>
    <tr>
      <td style="text-align: left">Log4j</td>
      <td style="text-align: left">log4j-spring.properties、log4j-spring.xml、log4j.properties 、log4j.xml</td>
    </tr>
    <tr>
      <td style="text-align: left">Log4j2</td>
      <td style="text-align: left">log4j2-spring.xml、log4j2.xml</td>
    </tr>
    <tr>
      <td style="text-align: left">JDK (Java Util Logging)</td>
      <td style="text-align: left">logging.properties</td>
    </tr>
  </tbody>
</table>

<p>对于<code class="highlighter-rouge">logback-spring.xml</code>这类的配置，建议使用<code class="highlighter-rouge">-spring</code>变量来加载配置文件。</p>

<p>Environment中可以自定义一些属性：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Spring Environment</th>
      <th style="text-align: left">System Property</th>
      <th style="text-align: left">Comments</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">logging.exception-conversion-word</code></td>
      <td style="text-align: left"><code class="highlighter-rouge">LOG_EXCEPTION_CONVERSION_WORD</code></td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">logging.file</code></td>
      <td style="text-align: left"><code class="highlighter-rouge">LOG_FILE</code></td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">logging.path</code></td>
      <td style="text-align: left"><code class="highlighter-rouge">LOG_PATH</code></td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">logging.pattern.console</code></td>
      <td style="text-align: left"><code class="highlighter-rouge">CONSOLE_LOG_PATTERN</code></td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">logging.pattern.file</code></td>
      <td style="text-align: left"><code class="highlighter-rouge">FILE_LOG_PATTERN</code></td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">logging.pattern.level</code></td>
      <td style="text-align: left"><code class="highlighter-rouge">LOG_LEVEL_PATTERN</code></td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">PID</code></td>
      <td style="text-align: left"><code class="highlighter-rouge">PID</code></td>
      <td style="text-align: left"> </td>
    </tr>
  </tbody>
</table>

<h1 id="web-1">5. 开发Web应用</h1>

<h2 id="spring-web-mvc">5.1 Spring Web MVC框架</h2>

<p>一个标准的<code class="highlighter-rouge">@RestController</code>例子返回JSON数据：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/users"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyRestController</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/{user}"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="n">getUser</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">Long</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ...</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/{user}/customers"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="n">getUserCustomers</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">Long</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ...</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/{user}"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="n">deleteUser</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">Long</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ...</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>

<h3 id="spring-mvc">5.1.1 Spring MVC自动配置</h3>

<p>Spring Boot为Spring MVC提供适用于多数应用的自动配置功能。在Spring默认基础上，自动配置添加了以下特性：</p>

<ul>
  <li>引入<code class="highlighter-rouge">ContentNegotiatingViewResolver</code><code class="highlighter-rouge">和BeanNameViewResolver</code> beans。</li>
  <li>对静态资源的支持，包括对WebJars的支持。</li>
  <li>自动注册<code class="highlighter-rouge">Converter</code>，<code class="highlighter-rouge">GenericConverter</code>，<code class="highlighter-rouge">Formatter</code> beans。</li>
  <li>对<code class="highlighter-rouge">HttpMessageConverters</code>的支持。</li>
  <li>自动注册<code class="highlighter-rouge">MessageCodeResolver</code>。</li>
  <li>对静态<code class="highlighter-rouge">index.html</code>的支持。</li>
  <li>对自定义<code class="highlighter-rouge">Favicon</code>的支持。</li>
  <li>字段使用 <code class="highlighter-rouge">ConfigurableWebBindingInitializer</code> bean</li>
</ul>

<p>如果想全面控制Spring MVC，你可以添加自己的<code class="highlighter-rouge">@Configuration</code>，并使用<code class="highlighter-rouge">@EnableWebMvc</code>对其注解。如果想保留Spring Boot MVC的特性，并只是添加其他的MVC配置(拦截器，formatters，视图控制器等)，你可以添加自己的<code class="highlighter-rouge">WebMvcConfigurerAdapter</code>类型的<code class="highlighter-rouge">@Bean</code>（不使用<code class="highlighter-rouge">@EnableWebMvc</code>注解）。</p>

<h3 id="httpmessageconverters">5.1.2 HttpMessageConverters</h3>

<p>Spring MVC使用<code class="highlighter-rouge">HttpMessageConverter</code>接口转换HTTP请求和响应。合理的缺省值被包含的恰到好处（out of the box），例如对象可以自动转换为JSON（使用Jackson库）或XML（如果Jackson XML扩展可用则使用它，否则使用JAXB）。字符串默认使用<code class="highlighter-rouge">UTF-8</code>编码。</p>

<p>如果需要添加或自定义转换器，你可以使用Spring Boot的<code class="highlighter-rouge">HttpMessageConverters</code>类：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.web.HttpMessageConverters</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.converter.*</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfiguration</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">HttpMessageConverters</span> <span class="n">customConverters</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">HttpMessageConverter</span><span class="o">&lt;?&gt;</span> <span class="n">additional</span> <span class="o">=</span> <span class="o">...</span>
        <span class="n">HttpMessageConverter</span><span class="o">&lt;?&gt;</span> <span class="n">another</span> <span class="o">=</span> <span class="o">...</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">HttpMessageConverters</span><span class="o">(</span><span class="n">additional</span><span class="o">,</span> <span class="n">another</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>任何在上下文中出现的<code class="highlighter-rouge">HttpMessageConverter</code> bean将会添加到converters列表，你可以通过这种方式覆盖默认的转换器（converters）。</p>

<h3 id="messagecodesresolver">5.1.3 MessageCodesResolver</h3>

<p>Spring MVC有一个策略，用于从绑定的errors产生用来渲染错误信息的错误码：MessageCodesResolver。如果设置<code class="highlighter-rouge">spring.mvc.message-codes-resolver.format</code>属性为<code class="highlighter-rouge">PREFIX_ERROR_CODE</code>或<code class="highlighter-rouge">POSTFIX_ERROR_CODE</code>（具体查看<code class="highlighter-rouge">DefaultMessageCodesResolver.Format</code>枚举值），Spring Boot会为你创建一个MessageCodesResolver。</p>

<h3 id="section-8">5.1.4 静态内容</h3>

<p>默认情况下，Spring Boot从classpath下一个叫<code class="highlighter-rouge">/static</code>（<code class="highlighter-rouge">/public</code>，<code class="highlighter-rouge">/resources</code>或<code class="highlighter-rouge">/META-INF/resources</code>）的文件夹或从<code class="highlighter-rouge">ServletContext</code>根目录提供静态内容。这使用了Spring MVC的<code class="highlighter-rouge">ResourceHttpRequestHandler</code>，所以你可以通过添加自己的<code class="highlighter-rouge">WebMvcConfigurerAdapter</code>并覆写<code class="highlighter-rouge">addResourceHandlers</code>方法来改变这个行为（加载静态文件）。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">class</span> <span class="nc">ClientResourcesConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">addResourceHandlers</span><span class="o">(</span><span class="n">ResourceHandlerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addResourceHandler</span><span class="o">(</span><span class="s">"/**"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addResourceLocations</span><span class="o">(</span><span class="s">"/WEB-INF/resources/"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setCachePeriod</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>在一个单独的web应用中，容器默认的servlet是开启的，如果Spring决定不处理某些请求，默认的servlet作为一个回退（降级）将从ServletContext根目录加载内容。大多数时候，这不会发生（除非你修改默认的MVC配置），因为Spring总能够通过<code class="highlighter-rouge">DispatcherServlet</code>处理请求。</p>

<p>此外，上述标准的静态资源位置有个例外情况是Webjars内容。任何在<code class="highlighter-rouge">/webjars/**</code>路径下的资源都将从jar文件中提供，只要它们以Webjars的格式打包。</p>

<p>注：如果你的应用将被打包成jar，那就不要使用<code class="highlighter-rouge">src/main/webapp</code>文件夹。尽管该文件夹是一个共同的标准，但它仅在打包成war的情况下起作用，并且如果产生一个jar，多数构建工具都会静悄悄的忽略它。</p>

<p>如果你想刷新静态资源的缓存，你可以定义一个使用HASH结尾的URL，例如：<code class="highlighter-rouge">&lt;link href="/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css"/&gt;</code>。</p>

<p>为此，需要使用以下配置：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="py">spring.resources.chain.strategy.content.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">spring.resources.chain.strategy.content.paths</span><span class="p">=</span><span class="s">/**</span>
</code></pre>
</div>

<blockquote>
  <p>这里使用了<code class="highlighter-rouge">ResourceUrlEncodingFilter</code>过滤器，对于Thymeleaf和Velocity，该过滤器已经自动配置。其他的模板引擎，可以通过<code class="highlighter-rouge">ResourceUrlProvider</code>来定义。</p>
</blockquote>

<p>当资源文件自动加载的时候，javascript模块加载器会重命名静态文件。还有一种“固定”的策略来修改文件名称。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="py">spring.resources.chain.strategy.content.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">spring.resources.chain.strategy.content.paths</span><span class="p">=</span><span class="s">/**</span>
<span class="py">spring.resources.chain.strategy.fixed.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">spring.resources.chain.strategy.fixed.paths</span><span class="p">=</span><span class="s">/js/lib/</span>
<span class="py">spring.resources.chain.strategy.fixed.version</span><span class="p">=</span><span class="s">v12</span>
</code></pre>
</div>

<p>使用了上面的配置之后，当javascript加载<code class="highlighter-rouge">"/js/lib/"</code>目录下的文件时，将会使用一个固定的版本<code class="highlighter-rouge">"/v12/js/lib/mymodule.js"</code>，而其他的静态资源仍然使用<code class="highlighter-rouge">&lt;link href="/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css"/&gt;</code>。</p>

<p>更多说明，参考<a href="http://github.com/spring-projects/spring-boot/tree/v1.3.2.RELEASE/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ResourceProperties.java">ResourceProperties</a>，或者阅读该偏<a href="https://spring.io/blog/2014/07/24/spring-framework-4-1-handling-static-web-resources">文章</a>。</p>

<h3 id="configurablewebbindinginitializer">5.1.5 ConfigurableWebBindingInitializer</h3>

<p>Spring MVC使用<code class="highlighter-rouge">WebBindingInitializer</code>来为一个特定的请求初始化<code class="highlighter-rouge">WebDataBinder</code>。如果你自带一个了一个<code class="highlighter-rouge">ConfigurableWebBindingInitializer</code> <code class="highlighter-rouge">@Bean</code>，Spring Boot会自动配置Spring MVC来使用它。</p>

<h3 id="section-9">5.1.6 模板引擎</h3>

<p>正如REST web服务，你也可以使用Spring MVC提供动态HTML内容。Spring MVC支持各种各样的模板技术，包括Velocity,FreeMarker和JSPs。很多其他的模板引擎也提供它们自己的Spring MVC集成。</p>

<p>Spring Boot为以下的模板引擎提供自动配置支持：</p>

<ul>
  <li>FreeMarker</li>
  <li>Groovy</li>
  <li>Thymeleaf</li>
  <li>Velocity</li>
  <li>Mustache</li>
</ul>

<p>注：如果可能的话，应该忽略JSPs，因为在内嵌的servlet容器使用它们时存在一些已知的限制。</p>

<p>当你使用这些引擎的任何一种，并采用默认的配置，你的模板将会从<code class="highlighter-rouge">src/main/resources/templates</code>目录下自动加载。</p>

<blockquote>
  <p>注：IntelliJ IDEA根据你运行应用的方式会对classpath进行不同的整理。在IDE里通过main方法运行你的应用跟从Maven或Gradle或打包好的jar中运行相比会导致不同的顺序。这可能导致Spring Boot不能从classpath下成功地找到模板。如果遇到这个问题，你可以在IDE里重新对classpath进行排序，将模块的类和资源放到第一位。或者，你可以配置模块的前缀为<code class="highlighter-rouge">classpath*:/templates/</code>，这样会查找classpath下的所有模板目录。</p>
</blockquote>

<h3 id="section-10">5.1.7 错误处理</h3>

<p>Spring Boot默认提供一个<code class="highlighter-rouge">/error</code>映射用来以合适的方式处理所有的错误，并且它在servlet容器中注册了一个全局的 错误页面。对于机器客户端（相对于浏览器而言，浏览器偏重于人的行为），它会产生一个具有详细错误，HTTP状态，异常信息的JSON响应。对于浏览器客户端，它会产生一个白色标签样式（whitelabel）的错误视图，该视图将以HTML格式显示同样的数据（可以添加一个解析为erro的View来自定义它）。为了完全替换默认的行为，你可以实现<code class="highlighter-rouge">ErrorController</code>，并注册一个该类型的bean定义，或简单地添加一个<code class="highlighter-rouge">ErrorAttributes</code>类型的bean以使用现存的机制，只是替换显示的内容。</p>

<p>如果在某些条件下需要比较多的错误页面，内嵌的servlet容器提供了一个统一的Java DSL（领域特定语言）来自定义错误处理。 示例：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">EmbeddedServletContainerCustomizer</span> <span class="nf">containerCustomizer</span><span class="p">(</span><span class="o">){</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">MyCustomizer</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// ...</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyCustomizer</span> <span class="kd">implements</span> <span class="n">EmbeddedServletContainerCustomizer</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">customize</span><span class="o">(</span><span class="n">ConfigurableEmbeddedServletContainer</span> <span class="n">container</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">container</span><span class="o">.</span><span class="na">addErrorPages</span><span class="o">(</span><span class="k">new</span> <span class="n">ErrorPage</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">,</span> <span class="s">"/400"</span><span class="o">));</span>
        <span class="n">container</span><span class="o">.</span><span class="na">addErrorPages</span><span class="o">(</span><span class="k">new</span> <span class="n">ErrorPage</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">,</span> <span class="s">"/404"</span><span class="o">));</span>
        <span class="n">container</span><span class="o">.</span><span class="na">addErrorPages</span><span class="o">(</span><span class="k">new</span> <span class="n">ErrorPage</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="o">,</span> <span class="s">"/500"</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>你也可以使用常规的Spring MVC特性来处理错误，比如<code class="highlighter-rouge">@ExceptionHandler</code>方法和<code class="highlighter-rouge">@ControllerAdvice</code>。<code class="highlighter-rouge">ErrorController</code>将会捡起任何没有处理的异常。</p>

<p>N.B. 如果你为一个路径注册一个<code class="highlighter-rouge">ErrorPage</code>，最终被一个过滤器（Filter）处理（对于一些非Spring web框架，像Jersey和Wicket这很常见），然后过滤器需要显式注册为一个<code class="highlighter-rouge">ERROR</code>分发器（dispatcher）。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">FilterRegistrationBean</span> <span class="nf">myFilter</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">FilterRegistrationBean</span> <span class="n">registration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilterRegistrationBean</span><span class="o">();</span>
    <span class="n">registration</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">MyFilter</span><span class="o">());</span>
    <span class="o">...</span>
    <span class="n">registration</span><span class="o">.</span><span class="na">setDispatcherTypes</span><span class="o">(</span><span class="n">EnumSet</span><span class="o">.</span><span class="na">allOf</span><span class="o">(</span><span class="n">DispatcherType</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="k">return</span> <span class="n">registration</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>注：默认的FilterRegistrationBean没有包含ERROR分发器类型。</p>

<h3 id="spring-hateoas">5.1.8 Spring HATEOAS</h3>

<p>如果你正在开发一个使用超媒体的RESTful API，Spring Boot将为Spring HATEOAS提供自动配置，这在多数应用中都工作良好。自动配置替换了对使用<code class="highlighter-rouge">@EnableHypermediaSupport</code>的需求，并注册一定数量的beans来简化构建基于超媒体的应用，这些beans包括一个<code class="highlighter-rouge">LinkDiscoverer</code>和配置好的用于将响应正确编排为想要的表示的<code class="highlighter-rouge">ObjectMapper</code>。ObjectMapper可以根据<code class="highlighter-rouge">spring.jackson.*</code>属性或一个存在的<code class="highlighter-rouge">Jackson2ObjectMapperBuilder</code> bean进行自定义。</p>

<p>通过使用<code class="highlighter-rouge">@EnableHypermediaSupport</code>，你可以控制Spring HATEOAS的配置。注意这会禁用上述的对<code class="highlighter-rouge">ObjectMapper</code>的自定义。</p>

<h3 id="cors">5.1.9 CORS支持</h3>

<p>你可以在方法上使用<code class="highlighter-rouge">@CrossOrigin</code>注解，或者配置一个全局的设置：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfiguration</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">WebMvcConfigurer</span> <span class="n">corsConfigurer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">WebMvcConfigurerAdapter</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="n">addCorsMappings</span><span class="o">(</span><span class="n">CorsRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">registry</span><span class="o">.</span><span class="na">addMapping</span><span class="o">(</span><span class="s">"/api/**"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="jax-rsjersey">5.2 JAX-RS和Jersey</h2>

<p>如果喜欢JAX-RS为REST端点提供的编程模型，你可以使用可用的实现替代Spring MVC。如果在你的应用上下文中将Jersey 1.x和Apache Celtix的Servlet或Filter注册为一个@Bean，那它们工作的相当好。Jersey 2.x有一些原生的Spring支持，所以我们会在Spring Boot为它提供自动配置支持，连同一个启动器（starter）。</p>

<p>想要开始使用Jersey 2.x只需要加入spring-boot-starter-jersey依赖，然后你需要一个ResourceConfig类型的@Bean，用于注册所有的端点（endpoints）。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JerseyConfig</span> <span class="kd">extends</span> <span class="n">ResourceConfig</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">JerseyConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">register</span><span class="o">(</span><span class="n">Endpoint</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>所有注册的端点都应该被@Components和HTTP资源annotations（比如@GET）注解。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Endpoint</span> <span class="o">{</span>
    <span class="nd">@GET</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">message</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Hello"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>由于Endpoint是一个Spring组件（@Component），所以它的生命周期受Spring管理，并且你可以使用@Autowired添加依赖及使用@Value注入外部配置。Jersey servlet将被注册，并默认映射到/*。你可以将@ApplicationPath添加到ResourceConfig来改变该映射。</p>

<p>默认情况下，Jersey将在一个ServletRegistrationBean类型的@Bean中被设置成名称为jerseyServletRegistration的Servlet。通过创建自己的相同名称的bean，你可以禁止或覆盖这个bean。你也可以通过设置<code class="highlighter-rouge">spring.jersey.type=filter</code>来使用一个Filter代替Servlet（在这种情况下，被覆盖或替换的@Bean是jerseyFilterRegistration）。该servlet有@Order属性，你可以通过<code class="highlighter-rouge">spring.jersey.filter.order</code>进行设置。不管是Servlet还是Filter注册都可以使用<code class="highlighter-rouge">spring.jersey.init.*</code>定义一个属性集合作为初始化参数传递过去。</p>

<p>这里有一个<a href="http://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples/spring-boot-sample-jersey">Jersey</a>示例，你可以查看如何设置相关事项。</p>

<h2 id="section-11">5.3 内嵌的容器支持</h2>

<h3 id="servletsfilters">5.3.1 Servlets和Filters</h3>

<p>当使用内嵌的servlet容器时，你可以直接将servlet和filter注册为Spring的beans。在配置期间，如果你想引用来自application.properties的值，这是非常方便的。默认情况下，如果上下文只包含单一的Servlet，那它将被映射到根路径（/）。在多Servlet beans的情况下，bean的名称将被用作路径的前缀。过滤器会被映射到/*。</p>

<p>如果基于约定（convention-based）的映射不够灵活，你可以使用ServletRegistrationBean和FilterRegistrationBean类实现完全的控制。如果你的bean实现了ServletContextInitializer接口，也可以直接注册它们。</p>

<h3 id="embeddedwebapplicationcontext">EmbeddedWebApplicationContext</h3>

<p>Spring Boot底层使用了一个新的ApplicationContext类型，用于对内嵌servlet容器的支持。EmbeddedWebApplicationContext是一个特殊类型的WebApplicationContext，它通过搜索一个单一的EmbeddedServletContainerFactory bean来启动自己。通常，TomcatEmbeddedServletContainerFactory，JettyEmbeddedServletContainerFactory或UndertowEmbeddedServletContainerFactory将被自动配置。</p>

<p>注：你通常不需要知道这些实现类。大多数应用将被自动配置，并根据你的行为创建合适的ApplicationContext和EmbeddedServletContainerFactory。</p>

<h3 id="servlet">自定义内嵌servlet容器</h3>

<p>常见的Servlet容器设置可以通过Spring Environment属性进行配置。通常，你会把这些属性定义到application.properties文件中。 常见的服务器设置包括：</p>

<ul>
  <li>server.port - 进来的HTTP请求的监听端口号</li>
  <li>server.address - 绑定的接口地址</li>
  <li>server.sessionTimeout - session超时时间</li>
</ul>

<p>具体参考<a href="http://github.com/spring-projects/spring-boot/tree/master/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java">ServerProperties</a>。</p>

<h4 id="section-12">编程方式的自定义</h4>

<p>如果需要以编程的方式配置内嵌的servlet容器，你可以注册一个实现EmbeddedServletContainerCustomizer接口的Spring bean。EmbeddedServletContainerCustomizer提供对ConfigurableEmbeddedServletContainer的访问，ConfigurableEmbeddedServletContainer包含很多自定义的setter方法。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.boot.context.embedded.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomizationBean</span> <span class="kd">implements</span> <span class="n">EmbeddedServletContainerCustomizer</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">customize</span><span class="o">(</span><span class="n">ConfigurableEmbeddedServletContainer</span> <span class="n">container</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">container</span><span class="o">.</span><span class="na">setPort</span><span class="o">(</span><span class="mi">9000</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="configurableembeddedservletcontainer">直接自定义ConfigurableEmbeddedServletContainer</h4>

<p>如果上面的自定义手法过于受限，你可以自己注册TomcatEmbeddedServletContainerFactory，JettyEmbeddedServletContainerFactory或UndertowEmbeddedServletContainerFactory。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">EmbeddedServletContainerFactory</span> <span class="nf">servletContainer</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">TomcatEmbeddedServletContainerFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TomcatEmbeddedServletContainerFactory</span><span class="o">();</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setPort</span><span class="o">(</span><span class="mi">9000</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setSessionTimeout</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MINUTES</span><span class="o">);</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">addErrorPages</span><span class="o">(</span><span class="k">new</span> <span class="n">ErrorPage</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">,</span> <span class="s">"/notfound.html"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">factory</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>很多可选的配置都提供了setter方法，也提供了一些受保护的钩子方法以满足你的某些特殊需求。具体参考相关文档。</p>

<h3 id="jsp">JSP的限制</h3>

<p>在内嵌的servlet容器中运行一个Spring Boot应用时（并打包成一个可执行的存档archive），容器对JSP的支持有一些限制。</p>

<ul>
  <li>tomcat只支持war的打包方式，不支持可执行的jar。</li>
  <li>内嵌的Jetty目前不支持JSPs。</li>
  <li>Undertow不支持JSPs。</li>
</ul>

<p>这里有个<a href="http://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples/spring-boot-sample-web-jsp">JSP示例</a>，你可以查看如何设置相关事项。</p>

<h1 id="section-13">参考文章</h1>

<ul>
  <li><a href="http://docs.spring.io/spring-boot/docs/1.2.2.RELEASE/reference/htmlsingle">Spring Boot Reference Guide</a></li>
</ul>

                    <br/>
                    <div class="well">
                        原创文章，转载请注明： 转载自<a href="http://blog.javachen.com">JavaChen Blog</a>，作者：<a href="http://blog.javachen.com/about.html">JavaChen</a><br/>
                        本文链接地址：<a href="/2015/03/13/some-spring-boot-features.html">http://blog.javachen.com/2015/03/13/some-spring-boot-features.html</a><br/>
                        本文基于<a target="_blank" title="Creative Commons Attribution 2.5 China Mainland License" href="http://creativecommons.org/licenses/by/2.5/cn/">署名2.5中国大陆许可协议</a>发布，欢迎转载、演绎或用于商业目的，但是必须保留本文署名和文章链接。
                        如您有任何疑问或者授权方面的协商，请邮件联系我</a>。
                    </div>
                    <div class="col-md-6">
                      <p class="text-success hidden-print"><i class="fa fa-external-link"></i> <a href="/2015/03/13/some-spring-boot-features.html">Spring Boot特性</a></p>
                    </div>
                    <div class="col-md-6">
                       <p class="meta hidden-print pull-right">
                        
                            <i class="fa fa-folder-open"></i>
                            
                            <a class="btn btn-default btn-sm" href="/categories.html#java">java</a>
                          
                        
                        
                            <i class="fa fa-tags"></i>
                            
                            <a class="btn btn-default btn-sm" href="/tags.html#java">java</a>
                          
                            <a class="btn btn-default btn-sm" href="/tags.html#spring+boot">spring boot</a>
                          
                        </p>
                    </div>
               </div><!--#post-text-->
          </div><!--#post-->
      </div> <!--#content-->

      <div id="post-comment" class="hidden-print">
      
<div id="comments">
  <div class="ds-thread" data-thread-key="/2015/03/13/some-spring-boot-features.html" data-url="http://blog.javachen.com/2015/03/13/some-spring-boot-features.html" data-title="Spring Boot特性"></div>
</div>



      </div>


          </div>
          <a href="#" class="btn back-to-top btn-dark btn-fixed-bottom hidden-print"><i class="fa fa-chevron-up"></i></a>
      </div>
      <div id="footer">
          <div class="container hidden-print">
              <p class="text-center"><i class="fa fa-copyright"></i> 2016 JavaChen Blog. Theme designed by <a href="/about.html" target="_blank" title="">JavaChen</a> with <a href="https://github.com/mojombo/jekyll/">Jekyll</a>, <a href="http://twitter.github.com/bootstrap/">Bootstrap</a> and <a href="http://fortawesome.github.com/Font-Awesome/">Font Awesome</a>.
  	            

            
            <script>
              var _hmt = _hmt || [];
              (function() {
                var hm = document.createElement("script");
                hm.src = "//hm.baidu.com/hm.js?50bc6f5d9b045b5895ff44f8bbdbc611";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
              })();
            </script>
            
    </p>
          </div>
      </div>

      <script type="text/javascript" src="/static/contrib/jquery/jquery.min.js"></script>
      <script type="text/javascript" src="/static/contrib/bootstrap/js/bootstrap.min.js"></script>
      <script type="text/javascript" src="/static/contrib/qrcode/jquery.qrcode.min.js"></script>
      <script type="text/javascript" src="/static/contrib/showup/showup.js"></script>
      <script type="text/javascript" src="/static/js/core.js"></script>
      
      <script type="text/javascript">
      var duoshuoQuery = {short_name:"javachen"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = 'http://static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] ||
        document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
      

      <script type="text/javascript">
      $('#qr').qrcode({
          width: 128,
          height: 128,
          text: 'http://blog.javachen.com/2015/03/13/some-spring-boot-features.html'
      });
      </script>
  </body>
</html>
