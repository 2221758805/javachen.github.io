<!DOCTYPE html>
<html lang="zh-cn">
        <head>
      <meta charset="utf-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
      <title>Bash条件判断 - JavaChen Blog</title>
      <meta name="author" content="yuke"/>
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
      <link rel="canonical" href="http://blog.javachen.com/2015/07/08/bash-if-else.html" />

      <link rel="stylesheet" href="/static/contrib/bootstrap/css/bootstrap.min.css" media="all" />
      <link rel="stylesheet" href="/static/css/style.css" media="all" />
      <link rel="stylesheet" href="/static/css/pygments.css" media="all" />
      <link rel="stylesheet" href="/static/contrib/font-awesome/css/font-awesome.min.css" media="all" />
      <link rel="stylesheet" type="text/css" href="/static/contrib/showup/showup.css" />

      <!-- atom & rss feed -->
      <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="JavaChen Blog RSS Feed" />
      <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="JavaChen Blog ATOM Feed" />

        <!-- fav and touch icons  -->
        <!-- Update these with your own images
        <link rel="shortcut icon" href="images/favicon.ico">
        <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
        -->

      <meta name="renderer" content="webkit|ie-stand">
      <meta name="baidu-site-verification" content="3HAhaWRiyR" />
      <meta name="360-site-verification" content="9b7a87a1d52051c96644f0a9b8b79898" />
      <meta name="sogou_site_verification" content="ofwXWFdthV"/>
      <meta property="wb:webmaster" content="b6081b2b8ab84c60" />
    </head>

    <body>
      <!--[if lte IE 9]>
<div class="alert alert-warning">
  <p>Your Internet Explorer is not supported. Please upgrade your Internet Explorer to version 9+, or use latest <a href="http://www.google.com/chrome/" target="_blank" class="alert-link">Google chrome</a>、<a href="http://www.mozilla.org/firefox/" target="_blank" class="alert-link">Mozilla Firefox</a>.</p>
  <p>If you are using IE 9 or later, make sure you <a href="http://windows.microsoft.com/en-us/internet-explorer/use-compatibility-view#ie=ie-8" target="_blank" class="alert-link">turn off "Compatibility view"</a>.</p>
</div>
<![endif]-->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">JavaChen Blog</a>
        </div>
        <div class="navbar-collapse collapse">
            <form id="search-form" class="form-group navbar-form navbar-right" role="search">
                  <div class="form-group">
                    <input type="text" name="q" value=""  id="query" class="form-control" placeholder="搜索" required autocomplete="off" ></input>
                    <input type="submit" class="btn btn-default" value=" Go" ></input>
                  </div>
              </form>
            <ul class="nav navbar-nav">
              <li><a href="/archive.html" title="Archive"><span class='fa fa-archive fa-2x'></span></a></li>
              <li><a href="/categories.html" title="Categories"><span class='fa fa-navicon fa-2x'></span></a></li>
              <li><a href="/tags.html" title="Tags"><span class='fa fa-tags fa-2x'></span></a></li>
              <li><a href="/about.html" title="About"><span class='fa fa-user fa-2x'></span></a></li>
              
              <li><a href="https://github.com/javachen" target="_blank" title="Github"><span class='fa fa-github fa-2x'></span></a></li>
              
              
              
              <li><a href="https://twitter.com/java_chen" target="_blank" title="twitter"><span class="fa fa-twitter fa-2x"></span></a></li>
              
              
              
              <li><a href="http://weibo.com/chenzhijun" target="_blank" title="Weibo"><span class="fa fa-weibo fa-2x"></span></a></li>
              
              <li><a href="/rss.xml" target="_blank" title="RSS"><span class='fa fa-rss fa-2x'></span></a></li>
            </ul>
        </div>

        </div><!--/.nav-collapse -->
      </div>
</div>

      <div id="wrap">
          <div class="container">
                 <div id="content">
          <ul class="pager hidden-print">
               
                <li class="previous"><a href="/2015/07/07/bash-variable.html" title="Bash中的变量"><i class="fa fa-angle-double-left"></i>&nbsp;Bash中的变量</a></li>
                
                
                <li class="next"><a href="/2015/07/09/bash-internal-variables.html" title="Bash内部变量">Bash内部变量&nbsp;<i class="fa fa-angle-double-right"></i></a></li>
                
          </ul>

           <div id="post" class="clearfix">
              <div id="post-title" class="page-header text-center">
                  <h1> Bash条件判断  </h1>
              </div>
              <p class="text-muted clearfix">
                  <span class="pull-right">2015.07.08 | <a href="#comments">Comments</a></span>
              </p>
              <div id="qr" class="qrcode visible-lg"></div>

              <div id="post-text">
                    <p>每个完整并且合理的程序语言都具有条件判断的功能，并且可以根据条件测试的结果做下一步的处理。Bash有test命令、各种中括号和圆括号操作，和if/then结构。</p>

<h1 id="条件测试">条件测试</h1>

<p>if/then结构用来判断命令列表的退出状态码是否为0。</p>

<p>有一个专有命令<code class="prettyprint">[</code>(左中括号，特殊字符)。这个命令与<code class="prettyprint">test</code>命令等价，并且出于效率上的考虑，这是一个<code class="prettyprint">内建命令</code>。这个命令把它的参数作为比较表达式或者作为文件测试，并且根据比较的结果来返回一个退出状态码(0 表示真，1表示假)。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">if</span>  <span class="o">[</span> <span class="m">0</span> <span class="o">]</span>      
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;0 is true.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;0 is false.&quot;</span>
<span class="k">fi</span>            
<span class="c"># 0 is true.</span>
</code></pre></div>
<p>在版本2.02的Bash中，引入了<code class="prettyprint">[[ ... ]]</code>扩展测试命令，因为这种表现形式可能对某些语言的程序员来说更容易熟悉一些。</p>

<blockquote>
<p>注意：<code class="prettyprint">[[</code>是一个<code class="prettyprint">关键字</code>，并不是一个命令。</p>
</blockquote>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[[</span> <span class="m">1</span> &lt; <span class="m">3</span> <span class="o">]]</span>
<span class="nb">echo</span> <span class="nv">$?</span>  
<span class="c"># 0</span>
</code></pre></div>
<p>Bash把<code class="prettyprint">[[ $a -lt $b ]]</code>看作一个单独的元素，并且返回一个退出状态码。<code class="prettyprint">(( ... ))</code>和<code class="prettyprint">let ...</code>结构也能够返回退出状态码，<strong>当它们所测试的算术表达式的结果为非零的时候，将会返回退出状态码0</strong>。这些算术扩展结构被用来做算术比较。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">let</span> <span class="s2">&quot;1&lt;2&quot;</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$?</span>
0

<span class="nv">$ </span><span class="o">((</span> <span class="m">0</span> <span class="o">&amp;&amp;</span> <span class="m">1</span> <span class="o">))</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$?</span>
1
</code></pre></div>
<p>if命令能够测试任何命令，并不仅仅是<code class="prettyprint">中括号</code>中的条件。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">cmp a b <span class="p">&amp;</span>&gt; /dev/null 

<span class="nb">echo</span> <span class="nv">$?</span>    <span class="c"># 2</span>

<span class="k">if</span> cmp a b <span class="p">&amp;</span>&gt; /dev/null  <span class="c"># 禁止输出.</span>
<span class="k">then</span> 
    <span class="nb">echo</span> <span class="s2">&quot;Files a and b are identical.&quot;</span>
<span class="k">else</span> 
    <span class="nb">echo</span> <span class="s2">&quot;Files a and b differ.&quot;</span>
<span class="k">fi</span>

<span class="c"># 非常有用的&quot;if-grep&quot;结构:</span>
<span class="k">if</span> grep -q bash /etc/profile
<span class="k">then</span> 
    <span class="nb">echo</span> <span class="s2">&quot;File contains at least one occurrence of Bash.&quot;</span>
<span class="k">fi</span>

<span class="nv">word</span><span class="o">=</span>Linux
<span class="nv">letter_sequence</span><span class="o">=</span>inu
<span class="k">if</span> <span class="nb">echo</span> <span class="s2">&quot;$word&quot;</span> <span class="p">|</span> grep -q <span class="s2">&quot;$letter_sequence&quot;</span>
<span class="c"># &quot;-q&quot; 选项是用来禁止输出的.</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;$letter_sequence found in $word&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;$letter_sequence not found in $word&quot;</span>
<span class="k">fi</span>

<span class="k">if</span> COMMAND_WHOSE_EXIT_STATUS_IS_0_UNLESS_ERROR_OCCURRED
<span class="k">then</span> 
    <span class="nb">echo</span> <span class="s2">&quot;Command succeeded.&quot;</span>
<span class="k">else</span> 
    <span class="nb">echo</span> <span class="s2">&quot;Command failed.&quot;</span>
<span class="k">fi</span>
</code></pre></div>
<p><strong>条件判断主要判断的是条件是否为真或者假。那么，在什么情况下才为真呢？</strong></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># 0 为真</span>
<span class="k">if</span> <span class="o">[</span> <span class="m">0</span> <span class="o">]</span>      
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;0 is true.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;0 is false.&quot;</span>
<span class="k">fi</span>

<span class="c"># 1 为真</span>
<span class="k">if</span> <span class="o">[</span> <span class="m">1</span> <span class="o">]</span>      
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;1 is true.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;1 is false.&quot;</span>
<span class="k">fi</span>

<span class="c"># -1 为真</span>
<span class="k">if</span> <span class="o">[</span> -1 <span class="o">]</span>      
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;-1 is true.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;-1 is false.&quot;</span>
<span class="k">fi</span>

<span class="c"># NULL 为假</span>
<span class="k">if</span> <span class="o">[</span>  <span class="o">]</span>      
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;NULL is true.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;NULL is false.&quot;</span>
<span class="k">fi</span>

<span class="c"># 随便的一串字符为真</span>
<span class="k">if</span> <span class="o">[</span> xyz <span class="o">]</span>      
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Random string is true.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;Random string is false.&quot;</span>
<span class="k">fi</span>

<span class="c"># 未初始化的变量为假</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$xyz</span> <span class="o">]</span>      
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Uninitialized variable is true.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;Uninitialized variable is false.&quot;</span>
<span class="k">fi</span>

<span class="c"># 更加正规的条件检查</span>
<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;$xyz&quot;</span> <span class="o">]</span>      
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Uninitialized variable is true.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;Uninitialized variable is false.&quot;</span>
<span class="k">fi</span>

<span class="nv">xyz</span><span class="o">=</span>     <span class="c"># 初始化了, 但是赋null值</span>

<span class="c"># null变量为假</span>
<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;$xyz&quot;</span> <span class="o">]</span>      
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Null variable is true.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;Null variable is false.&quot;</span>
<span class="k">fi</span>

<span class="c"># &quot;false&quot; 为真</span>
<span class="k">if</span> <span class="o">[</span>  <span class="s2">&quot;false&quot;</span> <span class="o">]</span>      
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;\&quot;false\&quot; is true.&quot;</span> 
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;\&quot;false\&quot; is false.&quot;</span> 
<span class="k">fi</span>

<span class="c"># 再来一个, 未初始化的变量</span>
<span class="c"># &quot;$false&quot; 为假</span>
<span class="k">if</span> <span class="o">[</span>  <span class="s2">&quot;$false&quot;</span> <span class="o">]</span>      
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;\&quot;\$false\&quot; is true.&quot;</span> 
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;\&quot;\$false\&quot; is false.&quot;</span> 
<span class="k">fi</span>
</code></pre></div>
<p><code class="prettyprint">[</code>这个命令与<code class="prettyprint">test</code>命令等价，把它的参数作为比较表达式或者作为文件测试，并且根据比较的结果来返回一个退出状态码(0 表示真，1表示假)，<strong>如果参数为确定的一个值或者有初始化，则退出状态码为0；否者为空值或者未初始化，则为1</strong>。上面例子也可以通过状态码来验证：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="o">[</span> <span class="m">0</span> <span class="o">]</span>  <span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span>
0
<span class="nv">$ </span><span class="o">[</span> <span class="m">1</span> <span class="o">]</span>  <span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span>
0
<span class="nv">$ </span><span class="o">[</span> -1 <span class="o">]</span>  <span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span>
0
<span class="nv">$ </span><span class="o">[</span>  <span class="o">]</span>  <span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span>
1
<span class="nv">$ </span><span class="o">[</span> xyz <span class="o">]</span>  <span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span>
0
<span class="nv">$ </span><span class="o">[</span> <span class="nv">$xyz</span> <span class="o">]</span> <span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span>
1
<span class="nv">$ </span><span class="o">[</span> -n <span class="s2">&quot;$xyz&quot;</span> <span class="o">]</span> <span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span>
1
<span class="nv">$ xyz</span><span class="o">=</span> <span class="p">;</span>  <span class="o">[</span> -n <span class="s2">&quot;$xyz&quot;</span> <span class="o">]</span> <span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span>
1
<span class="nv">$ </span><span class="o">[</span> <span class="s2">&quot;false&quot;</span> <span class="o">]</span> <span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span>
0
<span class="nv">$ </span><span class="o">[</span>  <span class="s2">&quot;$false&quot;</span> <span class="o">]</span> <span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span>
1
</code></pre></div>
<p>如果if和then在条件判断的同一行上的话，必须使用分号来结束if表达式。if和then都是关键字，关键字(或者命令)如果作为表达式的开头，并且如果想在同一行上再写一个新的表达式的话，那么必须使用分号来结束上一句表达式。</p>

<p>if语句里还可以加上elif分支，elif是else if的缩写形式，作用是在外部的判断结构中再嵌入一个内部的if/then结构。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">if</span> <span class="o">[</span> condition1 <span class="o">]</span>
<span class="k">then</span>
    command1
    command2
    command3
<span class="k">elif</span> <span class="o">[</span> condition2 <span class="o">]</span>
<span class="c"># 与else if一样</span>
<span class="k">then</span>
    command4
    command5
<span class="k">else</span>
    default-command
<span class="k">fi</span>
</code></pre></div>
<p><code class="prettyprint">if test condition-true</code>结构与<code class="prettyprint">if [ condition-true ]</code>完全相同. 就像我们前面所看到的，左中括号是调用<code class="prettyprint">test</code>命令的标识，而关闭条件判断用的的右中括号在if/test结构中并不是严格必需的，但是在Bash的新版本中必须要求使用。</p>

<blockquote>
<p>注意：
<code class="prettyprint">test</code>命令在Bash中是内建命令，用来测试文件类型，或者用来比较字符串。因此，在Bash脚本中，test命令并不会调用外部的/usr/bin/test中的test命令，这是sh-utils工具包中的一部分。同样的，<code class="prettyprint">[</code>也并不会调用<code class="prettyprint">/usr/bin/[</code>，这是/usr/bin/test的符号链接。</p>
</blockquote>

<p>下面测试type命令：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">bash<span class="nv">$ </span><span class="nb">type test</span>
<span class="nb">test </span>is a shell <span class="nb">builtin</span>
bash<span class="nv">$ </span><span class="nb">type</span> <span class="s1">&#39;[&#39;</span>
<span class="o">[</span> is a shell <span class="nb">builtin</span>
bash<span class="nv">$ </span><span class="nb">type</span> <span class="s1">&#39;[[&#39;</span>
<span class="o">[[</span> is a shell keyword
bash<span class="nv">$ </span><span class="nb">type</span> <span class="s1">&#39;]]&#39;</span>
<span class="o">]]</span> is a shell keyword
bash<span class="nv">$ </span><span class="nb">type</span> <span class="s1">&#39;]&#39;</span>
bash: <span class="nb">type</span>: <span class="o">]</span>: not found
</code></pre></div>
<p><code class="prettyprint">test</code>、<code class="prettyprint">/usr/bin/test</code>、<code class="prettyprint">[ ]</code>和<code class="prettyprint">/usr/bin/[</code>都是等价命令。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">if</span> <span class="nb">test</span> -z <span class="s2">&quot;$1&quot;</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;No command-line arguments.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;First command-line argument is $1.&quot;</span>
<span class="k">fi</span>

<span class="k">if</span> /usr/bin/test -z <span class="s2">&quot;$1&quot;</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;No command-line arguments.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;First command-line argument is $1.&quot;</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$1&quot;</span> <span class="o">]</span> 
<span class="c">#   if [ -z &quot;$1&quot;                应该能够运行，但是Bash报错, 提示缺少关闭条件测试的右中括号</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;No command-line arguments.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;First command-line argument is $1.&quot;</span>
<span class="k">fi</span>

<span class="k">if</span> /usr/bin/<span class="o">[</span> -z <span class="s2">&quot;$1&quot;</span> <span class="o">]</span>  
<span class="c"># if /usr/bin/[ -z &quot;$1&quot;       # 能够工作，但是还是给出一个错误消息。注意：在版本3.x的Bash中, 这个bug已经被修正了</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;No command-line arguments.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;First command-line argument is $1.&quot;</span>
<span class="k">fi</span>
</code></pre></div>
<p><code class="prettyprint">[[ ]]</code>结构比<code class="prettyprint">[   ]</code>结构更加通用。这是一个扩展的test命令，是从ksh88中引进的。在<code class="prettyprint">[[</code>和<code class="prettyprint">]]</code>之间<strong>所有的字符都不会发生文件名扩展或者单词分割，但是会发生参数扩展和命令替换</strong>。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">file</span><span class="o">=</span>/etc/passwd

<span class="k">if</span> <span class="o">[[</span> -e <span class="nv">$file</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Password file exists.&quot;</span>
<span class="k">fi</span>
</code></pre></div>
<p>使用<code class="prettyprint">[[ ... ]]</code>条件判断结构而不是<code class="prettyprint">[ ... ]</code>，能够防止脚本中的许多逻辑错误。比如<code class="prettyprint">&amp;&amp;</code>、<code class="prettyprint">||</code>、<code class="prettyprint">&lt;</code>和<code class="prettyprint">&gt;</code>操作符能够正常存在于<code class="prettyprint">[[ ]]</code>条件判断结构中,，但是如果出现在<code class="prettyprint">[ ]</code>结构中的话，会报错。</p>

<p><strong>在if后面也不一定非得是test命令或者是用于条件判断的中括号结构</strong>。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">dir</span><span class="o">=</span>/home/bozo

<span class="k">if</span> <span class="nb">cd</span> <span class="s2">&quot;$dir&quot;</span> 2&gt;/dev/null<span class="p">;</span> <span class="k">then</span>   <span class="c"># &quot;2&gt;/dev/null&quot; 会隐藏错误信息.</span>
    <span class="nb">echo</span> <span class="s2">&quot;Now in $dir.&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;Can&#39;t change to $dir.&quot;</span>
<span class="k">fi</span>
</code></pre></div>
<p>&quot;if COMMAND&quot;结构将会返回COMMAND的退出状态码。与此相似，在中括号中的条件判断也不一定非得要if不可，也可以使用<code class="prettyprint">列表结构</code>。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">var1</span><span class="o">=</span>20
<span class="nv">var2</span><span class="o">=</span>22
<span class="o">[</span> <span class="s2">&quot;$var1&quot;</span> -ne <span class="s2">&quot;$var2&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;$var1 is not equal to $var2&quot;</span>

<span class="nv">home</span><span class="o">=</span>/home/bozo
<span class="o">[</span> -d <span class="s2">&quot;$home&quot;</span> <span class="o">]</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">&quot;$home directory does not exist.&quot;</span>
</code></pre></div>
<p><code class="prettyprint">(( ))</code>结构扩展并计算一个算术表达式的值。如果表达式的结果为0，那么返回的退出状态码为1，或者是&quot;假&quot;。而<strong>一个非零值的表达式所返回的退出状态码将为0</strong>，或者是&quot;true&quot;。<strong>这种情况和先前所讨论的<code class="prettyprint">test</code>命令和<code class="prettyprint">[ ]</code>结构的行为正好相反</strong>。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>
<span class="c"># 算术测试.</span>

<span class="c"># (( ... ))结构可以用来计算并测试算术表达式的结果. </span>
<span class="c"># 退出状态将会与[ ... ]结构完全相反!</span>

<span class="o">((</span> <span class="m">0</span> <span class="o">))</span>
<span class="nb">echo</span> <span class="s2">&quot;Exit status of \&quot;(( 0 ))\&quot; is $?.&quot;</span>         <span class="c"># 1</span>

<span class="o">((</span> <span class="m">1</span> <span class="o">))</span>
<span class="nb">echo</span> <span class="s2">&quot;Exit status of \&quot;(( 1 ))\&quot; is $?.&quot;</span>         <span class="c"># 0</span>

<span class="o">((</span> <span class="m">5</span> &gt; <span class="m">4</span> <span class="o">))</span>                                      <span class="c"># 真</span>
<span class="nb">echo</span> <span class="s2">&quot;Exit status of \&quot;(( 5 &gt; 4 ))\&quot; is $?.&quot;</span>     <span class="c"># 0</span>

<span class="o">((</span> <span class="m">5</span> &gt; <span class="m">9</span> <span class="o">))</span>                                      <span class="c"># 假</span>
<span class="nb">echo</span> <span class="s2">&quot;Exit status of \&quot;(( 5 &gt; 9 ))\&quot; is $?.&quot;</span>     <span class="c"># 1</span>

<span class="o">((</span> <span class="m">5</span> - <span class="m">5</span> <span class="o">))</span>                                      <span class="c"># 0</span>
<span class="nb">echo</span> <span class="s2">&quot;Exit status of \&quot;(( 5 - 5 ))\&quot; is $?.&quot;</span>     <span class="c"># 1</span>

<span class="o">((</span> <span class="m">5</span> / <span class="m">4</span> <span class="o">))</span>                                      <span class="c"># 除法也可以.</span>
<span class="nb">echo</span> <span class="s2">&quot;Exit status of \&quot;(( 5 / 4 ))\&quot; is $?.&quot;</span>     <span class="c"># 0</span>

<span class="o">((</span> <span class="m">1</span> / <span class="m">2</span> <span class="o">))</span>                                      <span class="c"># 除法的计算结果 &lt; 1.</span>
<span class="nb">echo</span> <span class="s2">&quot;Exit status of \&quot;(( 1 / 2 ))\&quot; is $?.&quot;</span>     <span class="c"># 截取之后的结果为 0.</span>
                                                    <span class="c"># 1</span>

<span class="o">((</span> <span class="m">1</span> / <span class="m">0</span> <span class="o">))</span> 2&gt;/dev/null                          <span class="c"># 除数为0, 非法计算. </span>
<span class="c">#            ^^^^^^^^^^^</span>
<span class="nb">echo</span> <span class="s2">&quot;Exit status of \&quot;(( 1 / 0 ))\&quot; is $?.&quot;</span>     <span class="c"># 1</span>

<span class="c"># &quot;2&gt;/dev/null&quot;起了什么作用?</span>
<span class="c"># 如果这句被删除会怎样?</span>
<span class="o">((</span> <span class="m">1</span> / <span class="m">0</span> <span class="o">))</span> 
<span class="nb">echo</span> <span class="s2">&quot;Exit status of \&quot;(( 1 / 0 ))\&quot; is $?.&quot;</span>     <span class="c"># 2</span>

<span class="nb">exit </span>0
</code></pre></div>
<p>就如文章开头所言，<code class="prettyprint">(( ... ))</code>和<code class="prettyprint">let ...</code>结构也能够返回退出状态码，当它们所测试的算术表达式的结果为非零的时候，将会返回退出状态码0。</p>

<h1 id="测试操作符">测试操作符</h1>

<p><strong>文件测试操作符</strong>：</p>

<ul>
<li><code class="prettyprint">-e</code> 文件存在</li>
<li><code class="prettyprint">-a</code> 文件存在，这个选项的效果与-e相同. 但是它已经被&quot;弃用&quot;了, 并且不鼓励使用.</li>
<li><code class="prettyprint">-f</code>  表示这个文件是一个一般文件(并不是目录或者设备文件)</li>
<li><code class="prettyprint">-s</code> 文件大小不为零</li>
<li><code class="prettyprint">-d</code> 表示这是一个目录</li>
<li><code class="prettyprint">-b</code> 表示这是一个块设备(软盘、光驱等。)</li>
<li><code class="prettyprint">-c</code> 表示这是一个字符设备(键盘, modem, 声卡, 等等.)</li>
<li><code class="prettyprint">-p</code> 这个文件是一个管道</li>
<li><code class="prettyprint">-h</code> 这是一个符号链接</li>
<li><code class="prettyprint">-L</code> 这是一个符号链接</li>
<li><code class="prettyprint">-S</code> 表示这是一个socket</li>
<li><code class="prettyprint">-t</code> 文件(描述符)被关联到一个终端设备上。这个测试选项一般被用来检测脚本中的stdin([ -t 0 ]) 或者stdout([ -t 1 ])是否来自于一个终端.</li>
<li><code class="prettyprint">-r</code> 文件是否具有可读权限(指的是正在运行这个测试命令的用户是否具有读权限)</li>
<li><code class="prettyprint">-w</code> 文件是否具有可写权限(指的是正在运行这个测试命令的用户是否具有写权限)</li>
<li><code class="prettyprint">-x</code> 文件是否具有可执行权限(指的是正在运行这个测试命令的用户是否具有可执行权限)</li>
<li><code class="prettyprint">-g</code> set-group-id(sgid)标记被设置到文件或目录上。如果目录具有sgid标记的话, 那么在这个目录下所创建的文件将属于拥有这个目录的用户组，而不必是创建这个文件的用户组. 这个特性对于在一个工作组中共享目录非常有用。</li>
<li><code class="prettyprint">-u</code> set-user-id (suid)标记被设置到文件上。如果一个root用户所拥有的二进制可执行文件设置了set-user-id标记位的话，那么普通用户也会以root权限来运行这个文件。这对于需要访问系统硬件的执行程序非常有用。如果没有suid标志的话，这些二进制执行程序是不能够被非root用户调用的。对于设置了suid标志的文件，在它的权限列中将会以s表示。</li>
<li><code class="prettyprint">-k</code> 设置粘贴位。粘贴位设置在目录中，它将限制写权限，在它们的权限标记列中将会显示t。如果用户并不拥有这个设置了粘贴位的目录，但是他在这个目录下具有写权限，那么这个用户只能在这个目录下删除自己所拥有的文件。这将有效的防止用户在一个公共目录中不慎覆盖或者删除别人的文件，比如说/tmp目录。</li>
<li><code class="prettyprint">-O</code> 判断你是否是文件的拥有者</li>
<li><code class="prettyprint">-G</code> 文件的group-id是否与你的相同</li>
<li><code class="prettyprint">-N</code> 从文件上一次被读取到现在为止，文件是否被修改过</li>
<li><code class="prettyprint">f1 -nt f2</code> 文件f1比文件f2新</li>
<li><code class="prettyprint">f1 -ot f2</code> 文件f1比文件f2旧</li>
<li><code class="prettyprint">f1 -ef f2</code> 文件f1和文件f2是相同文件的硬链接</li>
<li><code class="prettyprint">!</code> 反转上边所有测试的结果(如果没给出条件，那么返回真)。</li>
</ul>

<p><strong>二元比较操作符</strong>，用来比较两个变量或数字：</p>

<ul>
<li><code class="prettyprint">-eq</code> 等于 <code class="prettyprint">if [ &quot;$a&quot; -eq &quot;$b&quot; ]</code></li>
<li><code class="prettyprint">-ne</code> 不等于 <code class="prettyprint">if [ &quot;$a&quot; -ne &quot;$b&quot; ]</code></li>
<li><code class="prettyprint">-gt</code> 大于 <code class="prettyprint">if [ &quot;$a&quot; -gt &quot;$b&quot; ]</code></li>
<li><code class="prettyprint">-ge</code> 大于等于 <code class="prettyprint">if [ &quot;$a&quot; -ge &quot;$b&quot; ]</code></li>
<li><code class="prettyprint">-lt</code> 小于 <code class="prettyprint">if [ &quot;$a&quot; -lt &quot;$b&quot; ]</code></li>
<li><code class="prettyprint">-le</code> 小于等于 <code class="prettyprint">if [ &quot;$a&quot; -le &quot;$b&quot; ]</code></li>
<li><code class="prettyprint">&lt;</code> 小于(在<code class="prettyprint">双括号</code>中使用) <code class="prettyprint">((&quot;$a&quot; &lt; &quot;$b&quot;))</code></li>
<li><code class="prettyprint">&lt;=</code> 小于等于(在<code class="prettyprint">双括号</code>中使用) <code class="prettyprint">((&quot;$a&quot; &lt;= &quot;$b&quot;))</code></li>
<li><code class="prettyprint">&gt;</code> 大于(在<code class="prettyprint">双括号</code>中使用) <code class="prettyprint">((&quot;$a&quot; &gt; &quot;$b&quot;))</code></li>
<li><code class="prettyprint">&gt;=</code> 大于等于(在<code class="prettyprint">双括号</code>中使用) <code class="prettyprint">((&quot;$a&quot; &gt;= &quot;$b&quot;))</code></li>
<li><code class="prettyprint">-a</code> 逻辑与，一般都是和<code class="prettyprint">test</code>命令或者是<code class="prettyprint">单中括号</code>结构一起使用的 <code class="prettyprint">if [ &quot;$exp1&quot; -a &quot;$exp2&quot; ]</code></li>
<li><code class="prettyprint">-o</code> 逻辑或，一般都是和<code class="prettyprint">test</code>命令或者是<code class="prettyprint">单中括号</code>结构一起使用的 <code class="prettyprint">if [ &quot;$exp1&quot; -o &quot;$exp2&quot; ]</code></li>
</ul>

<p><strong>字符串比较</strong>：</p>

<ul>
<li><code class="prettyprint">=</code> 等于 <code class="prettyprint">if [ &quot;$a&quot; = &quot;$b&quot; ]</code></li>
<li><code class="prettyprint">==</code>等于 <code class="prettyprint">if [ &quot;$a&quot; == &quot;$b&quot; ]</code> 与<code class="prettyprint">=</code>等价</li>
<li><code class="prettyprint">!=</code> 不等号 <code class="prettyprint">if [ &quot;$a&quot; != &quot;$b&quot; ]</code> 这个操作符将在<code class="prettyprint">[[ ... ]]</code>结构中使用模式匹配</li>
<li><code class="prettyprint">&lt;</code> 小于，按照ASCII字符进行排序 <code class="prettyprint">if [[ &quot;$a&quot; &lt; &quot;$b&quot; ]]</code> <code class="prettyprint">if [ &quot;$a&quot; \&lt; &quot;$b&quot; ]</code> 注意使用在<code class="prettyprint">[ ]</code>结构中的时候需要被转义。</li>
<li><code class="prettyprint">&gt;</code> 大于，按照ASCII字符进行排序 <code class="prettyprint">if [[ &quot;$a&quot; &gt; &quot;$b&quot; ]]</code> <code class="prettyprint">if [ &quot;$a&quot; \&gt; &quot;$b&quot; ]</code> 注意使用在<code class="prettyprint">[ ]</code>结构中的时候需要被转义。</li>
<li><code class="prettyprint">-z</code> 字符串为&quot;null&quot;，意思就是字符串长度为零</li>
<li><code class="prettyprint">-n</code> 字符串不为&quot;null&quot;，当<code class="prettyprint">-n</code>使用在中括号中进行条件测试的时候，必须要把字符串用双引号引用起来。</li>
</ul>

<p>注意：<strong>==比较操作符在<code class="prettyprint">双中括号对</code>和<code class="prettyprint">单中括号对</code>中的行为是不同的</strong>。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">if</span> <span class="o">[[</span> <span class="nv">$a</span> <span class="o">==</span> z* <span class="o">]]</span>    <span class="c"># 如果$a以&quot;z&quot;开头(模式匹配)，那么结果将为真</span>
<span class="k">then</span> <span class="nb">echo true</span>
<span class="k">else</span> <span class="nb">echo false</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$a</span> <span class="o">==</span> <span class="s2">&quot;z*&quot;</span> <span class="o">]]</span>  <span class="c"># 如果$a与z*相等，就是字面意思完全一样，那么结果为真。</span>
<span class="k">then</span> <span class="nb">echo true</span>
<span class="k">else</span> <span class="nb">echo false</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$a</span> <span class="o">==</span> z* <span class="o">]</span>      <span class="c"># 如果$a与z*相等，就是字面意思完全一样，那么结果为真。不存在模式匹配</span>
<span class="k">then</span> <span class="nb">echo true</span>
<span class="k">else</span> <span class="nb">echo false</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$a&quot;</span> <span class="o">==</span> <span class="s2">&quot;z*&quot;</span> <span class="o">]</span>  <span class="c"># 如果$a与z*相等，就是字面意思完全一样，那么结果为真。</span>
<span class="k">then</span> <span class="nb">echo true</span>
<span class="k">else</span> <span class="nb">echo false</span>
<span class="k">fi</span>
</code></pre></div>
<p><strong>检查字符串是否为null</strong>，有以下几种方法：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>
<span class="c">#  str-test.sh: 检查null字符串和未引用的字符串</span>

<span class="k">if</span> <span class="o">[</span> -n <span class="nv">$string1</span> <span class="o">]</span>    <span class="c"># $string1 没有被声明和初始化</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;String \&quot;string1\&quot; is not null.&quot;</span>
<span class="k">else</span>  
    <span class="nb">echo</span> <span class="s2">&quot;String \&quot;string1\&quot; is null.&quot;</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;$string1&quot;</span> <span class="o">]</span>  <span class="c"># 这次$string1被引号扩起来了.</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;String \&quot;string1\&quot; is not null.&quot;</span>
<span class="k">else</span>  
    <span class="nb">echo</span> <span class="s2">&quot;String \&quot;string1\&quot; is null.&quot;</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$string1</span> <span class="o">]</span>       <span class="c"># 这次，就一个$string1，什么都不加</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;String \&quot;string1\&quot; is not null.&quot;</span>
<span class="k">else</span>  
    <span class="nb">echo</span> <span class="s2">&quot;String \&quot;string1\&quot; is null.&quot;</span>
<span class="k">fi</span>
<span class="c"># [ ] 测试操作符能够独立检查string是否为null，然而，使用(&quot;$string1&quot;)是一种非常好的习惯</span>
<span class="c"># if [ $string1 ]    只有一个参数 &quot;]&quot;</span>
<span class="c"># if [ &quot;$string1&quot; ]  有两个参数，一个是空的&quot;$string1&quot;，另一个是&quot;]&quot; </span>

<span class="nv">string1</span><span class="o">=</span>initialized

<span class="k">if</span> <span class="o">[</span> <span class="nv">$string1</span> <span class="o">]</span>        <span class="c"># 再来，还是只有$string1，什么都不加</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;String \&quot;string1\&quot; is not null.&quot;</span>
<span class="k">else</span>  
    <span class="nb">echo</span> <span class="s2">&quot;String \&quot;string1\&quot; is null.&quot;</span>
<span class="k">fi</span>
<span class="c"># 这个例子运行还是给出了正确的结果，但是使用引用的(&quot;$string1&quot;)还是更好一些</span>

<span class="nv">string1</span><span class="o">=</span><span class="s2">&quot;a = b&quot;</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$string1</span> <span class="o">]</span>        <span class="c"># 再来，还是只有$string1，什么都不加</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;String \&quot;string1\&quot; is not null.&quot;</span>
<span class="k">else</span>  
    <span class="nb">echo</span> <span class="s2">&quot;String \&quot;string1\&quot; is null.&quot;</span>
<span class="k">fi</span>
<span class="c"># 未引用的&quot;$string1&quot;，这回给出了错误的结果</span>

<span class="nb">exit </span>0
</code></pre></div>
<h1 id="总结">总结</h1>

<p>本篇文章介绍了如何使用Bash的条件判断，涉及到test命令、各种中括号和圆括号操作，以及if/then结构。需要知道，test、/usr/bin/test、[ ]和/usr/bin/[都是等价命令，使用type命令可以分区内建命令和关键字。另外，需要区分单中括号和双中括号以及双圆括号的含义是不同的。</p>

<ul>
<li>单中括号<code class="prettyprint">[</code>，与test命令等价，是个内建命令</li>
<li>双中括号<code class="prettyprint">[[</code>，是扩展测试命令，是个关键字</li>
<li>双圆括号<code class="prettyprint">(())</code>，是根据算术表达式运行结果来返回不同状态码</li>
</ul>

<p>使用<code class="prettyprint">[[ ... ]]</code>条件判断结构而不是<code class="prettyprint">[ ... ]</code>，能够防止脚本中的许多逻辑错误。比如<code class="prettyprint">&amp;&amp;</code>、<code class="prettyprint">||</code>、<code class="prettyprint">&lt;</code>和<code class="prettyprint">&gt;</code>操作符能够正常存在于<code class="prettyprint">[[ ]]</code>条件判断结构中,，但是如果出现在<code class="prettyprint">[ ]</code>结构中的话，会报错。</p>

<h1 id="参考文章">参考文章</h1>

<ul>
<li><a href="http://blog.javachen.com/static/doc/abs-guide/html/index.html">高级Bash脚本编程指南-中文版</a></li>
</ul>

                    <br/>
                    <div class="well">
                        原创文章，转载请注明： 转载自<a href="http://blog.javachen.com">JavaChen Blog</a>，作者：<a href="http://blog.javachen.com/about.html">yuke</a><br/>
                        本文链接地址：<a href="/2015/07/08/bash-if-else.html">http://blog.javachen.com/2015/07/08/bash-if-else.html</a><br/>
                        本文基于<a target="_blank" title="Creative Commons Attribution 2.5 China Mainland License" href="http://creativecommons.org/licenses/by/2.5/cn/">署名2.5中国大陆许可协议</a>发布，欢迎转载、演绎或用于商业目的，但是必须保留本文署名和文章链接。
                        如您有任何疑问或者授权方面的协商，请邮件联系我</a>。
                    </div>
                    <div class="col-md-6">
                      <p class="text-success hidden-print"><i class="fa fa-external-link"></i> <a href="/2015/07/08/bash-if-else.html">Bash条件判断</a></p>
                    </div>
                    <div class="col-md-6">
                       <p class="meta hidden-print pull-right">
                        
                            <i class="fa fa-folder-open"></i>
                            
                            <a class="btn btn-default btn-sm" href="/categories.html#devops">devops</a>
                          
                        
                        
                            <i class="fa fa-tags"></i>
                            
                            <a class="btn btn-default btn-sm" href="/tags.html#bash">bash</a>
                          
                        </p>
                    </div>
               </div><!--#post-text-->
          </div><!--#post-->
      </div> <!--#content-->

      <div id="post-comment" class="hidden-print">
      
<div id="comments">
  <div class="ds-thread" data-thread-key="/2015/07/08/bash-if-else.html" data-url="http://blog.javachen.com/2015/07/08/bash-if-else.html" data-title="Bash条件判断"></div>
</div>



      </div>


          </div>
          <a href="#" class="btn back-to-top btn-dark btn-fixed-bottom hidden-print"><i class="fa fa-chevron-up"></i></a>
      </div>
      <div id="footer">
          <div class="container hidden-print">
              <p class="text-center"><i class="fa fa-copyright"></i> 2015 JavaChen Blog. Theme designed by <a href="/about.html" target="_blank" title="">yuke</a> with <a href="https://github.com/mojombo/jekyll/">Jekyll</a>, <a href="http://twitter.github.com/bootstrap/">Bootstrap</a> and <a href="http://fortawesome.github.com/Font-Awesome/">Font Awesome</a>.
  	            
            <script type="text/javascript">
                var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
                document.write(unescape("%3Cspan id='cnzz_stat_icon_1256628929'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/z_stat.php%3Fid%3D1256628929' type='text/javascript'%3E%3C/script%3E"));</script>
            
            
    </p>
          </div>
      </div>

      <script type="text/javascript" src="/static/contrib/jquery/jquery.min.js"></script>
      <script type="text/javascript" src="/static/contrib/bootstrap/js/bootstrap.min.js"></script>
      <script type="text/javascript" src="/static/contrib/qrcode/jquery.qrcode.min.js"></script>
      <script type="text/javascript" src="/static/contrib/showup/showup.js"></script>
      <script type="text/javascript" src="/static/js/core.js"></script>
      
      <script type="text/javascript">
      var duoshuoQuery = {short_name:"javachen"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = 'http://static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] ||
        document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
      

      <script type="text/javascript">
      $('#qr').qrcode({
          width: 128,
          height: 128,
          text: 'http://blog.javachen.com/2015/07/08/bash-if-else.html'
      });
      </script>
  </body>
</html>
