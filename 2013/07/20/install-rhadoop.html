<!DOCTYPE html>
<html lang="zh-cn">
        <head>
      <meta charset="utf-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
      <title>安装RHadoop - JavaChen Blog</title>
      <meta name="author" content="JavaChen"/>
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
      <link rel="canonical" href="http://blog.javachen.com/2013/07/20/install-rhadoop.html" />

      <link rel="stylesheet" href="/static/contrib/bootstrap/css/bootstrap.min.css" media="all" />
      <link rel="stylesheet" href="/static/css/style.css" media="all" />
      <link rel="stylesheet" href="/static/css/pygments.css" media="all" />
      <link rel="stylesheet" href="/static/contrib/font-awesome/css/font-awesome.min.css" media="all" />
      <link rel="stylesheet" type="text/css" href="/static/contrib/showup/showup.css" />
        
        <!-- fav and touch icons  -->
        <!-- Update these with your own images
        <link rel="shortcut icon" href="images/favicon.ico">
        <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
        -->

      <meta name="renderer" content="webkit|ie-stand">
      <meta name="baidu-site-verification" content="3HAhaWRiyR" />
      <meta name="360-site-verification" content="9b7a87a1d52051c96644f0a9b8b79898" />
      <meta name="sogou_site_verification" content="ofwXWFdthV"/>
      <meta property="wb:webmaster" content="b6081b2b8ab84c60" />
    </head>

    <body>
      <!--[if lte IE 9]>
<div class="alert alert-warning">
  <p>Your Internet Explorer is not supported. Please upgrade your Internet Explorer to version 9+, or use latest <a href="http://www.google.com/chrome/" target="_blank" class="alert-link">Google chrome</a>、<a href="http://www.mozilla.org/firefox/" target="_blank" class="alert-link">Mozilla Firefox</a>.</p>
  <p>If you are using IE 9 or later, make sure you <a href="http://windows.microsoft.com/en-us/internet-explorer/use-compatibility-view#ie=ie-8" target="_blank" class="alert-link">turn off "Compatibility view"</a>.</p>
</div>
<![endif]-->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">JavaChen Blog</a>
        </div>
        <div class="navbar-collapse collapse">
            <form id="search-form" class="form-group navbar-form navbar-right" role="search">
                  <div class="form-group">
                    <input type="text" name="q" value=""  id="query" class="form-control" placeholder="搜索" required autocomplete="off" ></input>
                    <input type="submit" class="btn btn-default" value=" Go" ></input>
                  </div>
              </form>
            <ul class="nav navbar-nav">
              <li><a href="/archive.html" title="Archive"><span class='fa fa-archive fa-2x'></span></a></li>
              <li><a href="/categories.html" title="Categories"><span class='fa fa-navicon fa-2x'></span></a></li>
              <li><a href="/tags.html" title="Tags"><span class='fa fa-tags fa-2x'></span></a></li>
              <li><a href="/about.html" title="About"><span class='fa fa-user fa-2x'></span></a></li>
              
              <li><a href="https://github.com/javachen" target="_blank" title="Github"><span class='fa fa-github fa-2x'></span></a></li>
              
              
              
              
              
              <li><a href="http://weibo.com/chenzhijun" target="_blank" title="Weibo"><span class="fa fa-weibo fa-2x"></span></a></li>
              
              <li><a href="/rss.xml" target="_blank" title="RSS"><span class='fa fa-rss fa-2x'></span></a></li>
            </ul>
        </div>

        </div><!--/.nav-collapse -->
      </div>
</div>

      <div id="wrap">
          <div class="container">
                 <div id="content">
          <ul class="pager hidden-print">
               
                <li class="previous"><a href="/2013/06/24/install-cdh-by-cloudera-manager.html" title="通过Cloudera Manager安装CDH"><i class="fa fa-angle-double-left"></i>&nbsp;通过Cloudera Manager安装CDH</a></li>
                
                
                <li class="next"><a href="/2013/08/01/remote-debug-hadoop.html" title="远程调试Hadoop各组件">远程调试Hadoop各组件&nbsp;<i class="fa fa-angle-double-right"></i></a></li>
                
          </ul>

           <div id="post" class="clearfix">
              <div id="post-title" class="page-header text-center">
                  <h1> 安装RHadoop  </h1>
              </div>
              <p class="text-muted clearfix">
                  <span class="pull-right">2013.07.20 | <a href="#comments">Comments</a></span>
              </p>
              <div id="qr" class="qrcode visible-lg"></div>

              <div id="post-text">
                    <h1 id="r-language-install">1. R Language Install</h1>

<h2 id="section">安装相关依赖</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>yum install -y perl* pcre-devel tcl-devel zlib-devel bzip2-devel libX11-devel tk-devel tetex-latex *gfortran*  compat-readline5
yum install libRmath-*
rpm -Uvh --force --nodeps  R-core-2.10.0-2.el5.x86_64.rpm
rpm -Uvh R-2.10.0-2.el5.x86_64.rpm R-devel-2.10.0-2.el5.x86_64.rpm
</code></pre>
</div>

<!-- more -->

<h2 id="r-301">编译安装：R-3.0.1</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>tar -zxvf R-3.0.1 
./configure
make 
make install #R运行
export HADOOP_CMD=/usr/bin/hadoop
</code></pre>
</div>

<h2 id="section-1">排错</h2>

<p>1、错误1</p>

<div class="highlighter-rouge"><pre class="highlight"><code>error: --with-readline=yes (default) 
</code></pre>
</div>

<p>安装readline</p>

<div class="highlighter-rouge"><pre class="highlight"><code>yum install readline*
</code></pre>
</div>

<p>2、错误2</p>

<div class="highlighter-rouge"><pre class="highlight"><code>error: No F77 compiler found 
</code></pre>
</div>

<p>安装gfortran</p>

<p>3、错误3</p>

<div class="highlighter-rouge"><pre class="highlight"><code>error: –with-x=yes (default) and X11 headers/libs are not available 
</code></pre>
</div>

<p>安装</p>

<div class="highlighter-rouge"><pre class="highlight"><code>yum install libXt*
</code></pre>
</div>

<p>4、错误4</p>

<div class="highlighter-rouge"><pre class="highlight"><code>error: C++ preprocessor "/lib/cpp" fails sanity check 
</code></pre>
</div>

<p>安装g++或build-essential（redhat6.2安装gcc-c++和glibc-headers）</p>

<h2 id="section-2">验证是否安装成功</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>[root@node1 bin]# R
R version 3.0.1 (2013-05-16) -- "Good Sport"
Copyright (C) 2013 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

R是自由软件，不带任何担保。
在某些条件下你可以将其自由散布。
用'license()'或'licence()'来看散布的详细条件。

R是个合作计划，有许多人为之做出了贡献.
用'contributors()'来看合作者的详细情况
用'citation()'会告诉你如何在出版物中正确地引用R或R程序包。

用'demo()'来看一些示范程序，用'help()'来阅读在线帮助文件，或
用'help.start()'通过HTML浏览器来看帮助文件。
用'q()'退出R.
</code></pre>
</div>

<h1 id="rhadoop">2. 安装Rhadoop</h1>

<h2 id="rhdfsrmr2">安装rhdfs，rmr2</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>cd Rhadoop/
R CMD javareconf
R CMD INSTALL 'plyr_1.8.tar.gz'
R CMD INSTALL 'stringr_0.6.2.tar.gz'
R CMD INSTALL 'reshape2_1.2.2.tar.gz'
R CMD INSTALL 'digest_0.6.3.tar.gz'
R CMD INSTALL 'functional_0.4.tar.gz'
R CMD INSTALL 'iterators_1.0.6.tar.gz'
R CMD INSTALL 'itertools_0.1-1.tar.gz'
R CMD INSTALL 'Rcpp_0.10.3.tar.gz'
R CMD INSTALL 'rJava_0.9-4.tar.gz'
R CMD INSTALL 'RJSONIO_1.0-3.tar.gz'
R CMD INSTALL 'reshape2_1.2.2.tar.gz'
R CMD INSTALL 'rhdfs_1.0.5.tar.gz'
R CMD INSTALL 'rmr2_2.2.0.tar.gz'
</code></pre>
</div>

<p>R library(rhdfs)检查是否能正常工作</p>

<h2 id="section-3">验证测试</h2>

<p>Rmr测试命令：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&gt; train.mr&lt;-mapreduce( + train.hdfs, + map = function(k, v) { + keyval(k,v$item) + } + ,reduce=function(k,v){ + m&lt;-merge(v,v) + keyval(m$x,m$y) + } + )
</code></pre>
</div>

<p>出现如下错误：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>packageJobJar: [/tmp/RtmpCuhs7d/rmr-local-env18916b6f86b3, /tmp/RtmpCuhs7d/rmr-global-env18913824c681, /tmp/RtmpCuhs7d/rmr-streaming-map18912d6c2b1c, /tmp/RtmpCuhs7d/rmr-streaming-reduce1891179bb645, /tmp/hadoop-root/hadoop-unjar4575094085541826184/] [] /tmp/streamjob2910108622786868147.jar tmpDir=null 13/06/05 18:22:28
WARN mapred.JobClient: Use GenericOptionsParser for parsing the arguments. Applications should implement Tool for the same. 13/06/05 18:22:28 INFO mapred.FileInputFormat: Total input paths to process : 1 13/06/05 18:22:29
INFO streaming.StreamJob: getLocalDirs(): [/tmp/hadoop-root/mapred/local] 13/06/05 18:22:29 INFO streaming.StreamJob: Running job: job_201306050931_0004 13/06/05 18:22:29
INFO streaming.StreamJob: To kill this job, run: 13/06/05 18:22:29
INFO streaming.StreamJob: /usr/lib/hadoop/bin/hadoop job  -Dmapred.job.tracker=cdh1:8021 -kill job_201306050931_0004 13/06/05 18:22:29 INFO streaming.StreamJob: Tracking URL: http://cdh1:50030/jobdetails.jsp?jobid=job_201306050931_0004 13/06/05 18:22:30 
INFO streaming.StreamJob:  map 0%  reduce 0% 13/06/05 18:22:56
INFO streaming.StreamJob:  map 100%  reduce 100% 13/06/05 18:22:56
INFO streaming.StreamJob: To kill this job, run: 13/06/05 18:22:56
INFO streaming.StreamJob: /usr/lib/hadoop/bin/hadoop job  -Dmapred.job.tracker=cdh1:8021 -kill job_201306050931_0004 13/06/05 18:22:56
INFO streaming.StreamJob: Tracking URL: http://cdh1:50030/jobdetails.jsp?jobid=job_201306050931_0004 13/06/05 18:22:56 
ERROR streaming.StreamJob: Job not successful. Error: NA 13/06/05 18:22:56
INFO streaming.StreamJob: killJob... Streaming Command Failed! Error in mr(map = map, reduce = reduce, combine = combine, vectorized.reduce,  :   hadoop streaming failed with error code 1
</code></pre>
</div>

<p>错误解决方法： 通过查看日志，hadoop没有在<code class="highlighter-rouge">/usr/bin</code>下找到Rscript,于是从R的安装目录<code class="highlighter-rouge">/usr/local/bin</code>下做R和Rscript的符号链接到<code class="highlighter-rouge">/usr/bin</code>下，再次执行即可解决次错。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#ln -s /usr/loca/bin/R  /usr/bin
#ln -s /usr/local/bin/Rscript  /usr/bin
</code></pre>
</div>

<h1 id="rhbase">3. 安装rhbase</h1>
<p>## 安装依赖</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#yum install boost*
#yum install openssl*
</code></pre>
</div>

<h2 id="thrift">安装thrift</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>#tar -zxvf thrift-0.9.0.tar.gz
#mv thrift-0.9.0/lib/cpp/src/thrift/qt/moc_TQTcpServer.cpp  thrift-0.9.0/lib/cpp/src/thrift/qt/moc_TQTcpServer.cpp.bak
#cd thrift-0.9.0
#./configure --with-boost=/usr/include/boost JAVAC=/usr/java/jdk1.6.0_31/bin/javac
#make
#make install
</code></pre>
</div>

<p>如果报错：error: “Error: libcrypto required.”</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#yum install openssl*
</code></pre>
</div>

<p>如果报错：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>src/thrift/qt/moc_TQTcpServer.cpp:14:2: error: #error "This file was generated using the moc from 4.8.1. It"
src/thrift/qt/moc_TQTcpServer.cpp:15:2: error: #error "cannot be used with the include files from this version of Qt."
src/thrift/qt/moc_TQTcpServer.cpp:16:2: error: #error "(The moc has changed too much.)"
</code></pre>
</div>

<p>则运行下面命令：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#mv thrift-0.9.0/lib/cpp/src/thrift/qt/moc_TQTcpServer.cpp  thrift-0.9.0/lib/cpp/src/thrift/qt/moc_TQTcpServer.cpp.bak
</code></pre>
</div>

<h2 id="pkgconfigpath">配置PKG_CONFIG_PATH</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib/pkgconfig/
 	pkg-config --cflags thrift    #返回：-I/usr/local/include/thrift为正确
 	cp /usr/local/lib/libthrift-0.9.0.so /usr/lib/
 	cp /usr/local/lib/libthrift-0.9.0.so /usr/lib64/
</code></pre>
</div>

<p>启动hbase：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/usr/lib/hbase/bin/hbase-daemon.sh  start  thrift 
</code></pre>
</div>

<p>使用jps查看thrift进程</p>

<h2 id="rhbase-1">安装rhbase</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>R CMD INSTALL 'rhbase_1.1.1.tar.gz'
</code></pre>
</div>

<h2 id="section-4">验证并测试</h2>

<p>在R命令行中输入library(rmr2)、library(rhdfs)、library(rhbase)，载入成功即表示安装成功</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[root@desktop27 hadoop]# R
R version 3.0.1 (2013-05-16) -- "Good Sport"
Copyright (C) 2013 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)
R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.
Natural language support but running in an English locale
R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.
Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.
&gt; library(rhdfs)
Loading required package: rJava
HADOOP_CMD=/usr/bin/hadoop
Be sure to run hdfs.init()
&gt; library(rmr2)
Loading required package: Rcpp
Loading required package: RJSONIO
Loading required package: digest
Loading required package: functional
Loading required package: stringr
Loading required package: plyr
Loading required package: reshape2
&gt; library(rhbase)
&gt;
</code></pre>
</div>

<h1 id="rhive">4. 装RHive</h1>

<h2 id="section-5">环境变量</h2>
<p>设置环境变量 <code class="highlighter-rouge">vim /etc/profile</code>,末行添加如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>export HADOOP_CMD=/usr/bin/hadoop
export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig/
export HADOOP_STREAMING=/usr/lib/hadoop-0.20-mapreduce/contrib/streaming/hadoop-streaming-2.0.0-mr1-cdh4.2.1.jar
export HADOOP_HOME=/usr/lib/hadoop
export RHIVE_DATA=/hadoop/dfs/rhive/data
export HIVE_HOME=/usr/lib/hive
</code></pre>
</div>

<h2 id="rserve">安装Rserve：</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>#R CMD INSTALL 'Rserve_1.7-1.tar.gz'
</code></pre>
</div>

<p>在安装Rsever用户下，创建一目录，并创建Rserv.conf文件，写入``remote enable’‘保存并退出。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#cd /usr/local/lib64/R/
#echo remote enable &gt; Rserv.conf
</code></pre>
</div>

<p>启动Rserve：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#R CMD Rserve --RS-conf /usr/local/lib64/R/Rserv.conf
</code></pre>
</div>

<p>检查Rserve启动是否正常：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#telnet localhost 6311
</code></pre>
</div>

<p>显示 Rsrv0103QAP1 则表示连接成功</p>

<h2 id="rhive-1">安装RHive</h2>
<p>创建数据目录：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#R CMD INSTALL RHive_0.0-7.tar.gz
#cd /usr/local/lib64/R/
mkdir -p rhive/data
</code></pre>
</div>

<p>在上传rhive_udf.jar到hdfs上：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hadoop fs -mkdir /rhive/lib
cd /usr/local/lib64/R/library/RHive/java
hadoop fs -put rhive_udf.jar /rhive/lib
hadoop fs -chmod a+rw /rhive/lib/rhive_udf.jar
cd /usr/lib/hadoop
ln -s /etc/hadoop/conf conf
</code></pre>
</div>

<p>测试RHive安装是否成功：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>R
library（RHive）
rhive.connect('192.168.0.27')【hive的地址】
rhive.env()
</code></pre>
</div>


                    <br/>
                    <div class="well">
                        原创文章，转载请注明： 转载自<a href="http://blog.javachen.com">JavaChen Blog</a>，作者：<a href="http://blog.javachen.com/about.html">JavaChen</a><br/>
                        本文链接地址：<a href="/2013/07/20/install-rhadoop.html">http://blog.javachen.com/2013/07/20/install-rhadoop.html</a><br/>
                        本文基于<a target="_blank" title="Creative Commons Attribution 2.5 China Mainland License" href="http://creativecommons.org/licenses/by/2.5/cn/">署名2.5中国大陆许可协议</a>发布，欢迎转载、演绎或用于商业目的，但是必须保留本文署名和文章链接。
                        如您有任何疑问或者授权方面的协商，请邮件联系我</a>。
                    </div>
                    <div class="col-md-6">
                      <p class="text-success hidden-print"><i class="fa fa-external-link"></i> <a href="/2013/07/20/install-rhadoop.html">安装RHadoop</a></p>
                    </div>
                    <div class="col-md-6">
                       <p class="meta hidden-print pull-right">
                        
                            <i class="fa fa-folder-open"></i>
                            
                            <a class="btn btn-default btn-sm" href="/categories.html#hadoop">hadoop</a>
                          
                        
                        
                            <i class="fa fa-tags"></i>
                            
                            <a class="btn btn-default btn-sm" href="/tags.html#hadoop">hadoop</a>
                          
                            <a class="btn btn-default btn-sm" href="/tags.html#rhadoop">rhadoop</a>
                          
                        </p>
                    </div>
               </div><!--#post-text-->
          </div><!--#post-->
      </div> <!--#content-->

      <div id="post-comment" class="hidden-print">
      
<div id="comments">
  <div class="ds-thread" data-thread-key="/2013/07/20/install-rhadoop.html" data-url="http://blog.javachen.com/2013/07/20/install-rhadoop.html" data-title="安装RHadoop"></div>
</div>



      </div>


          </div>
          <a href="#" class="btn back-to-top btn-dark btn-fixed-bottom hidden-print"><i class="fa fa-chevron-up"></i></a>
      </div>
      <div id="footer">
          <div class="container hidden-print">
              <p class="text-center"><i class="fa fa-copyright"></i> 2016 JavaChen Blog. Theme designed by <a href="/about.html" target="_blank" title="JavaChen Blog
">JavaChen</a> with <a href="https://github.com/mojombo/jekyll/">Jekyll</a>, <a href="http://twitter.github.com/bootstrap/">Bootstrap</a> and <a href="http://fortawesome.github.com/Font-Awesome/">Font Awesome</a>.
  	            

            
            <script>
              var _hmt = _hmt || [];
              (function() {
                var hm = document.createElement("script");
                hm.src = "//hm.baidu.com/hm.js?50bc6f5d9b045b5895ff44f8bbdbc611";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
              })();
            </script>
            
    </p>
          </div>
      </div>

      <script type="text/javascript" src="/static/contrib/jquery/jquery.min.js"></script>
      <script type="text/javascript" src="/static/contrib/bootstrap/js/bootstrap.min.js"></script>
      <script type="text/javascript" src="/static/contrib/qrcode/jquery.qrcode.min.js"></script>
      <script type="text/javascript" src="/static/contrib/showup/showup.js"></script>
      <script type="text/javascript" src="/static/js/core.js"></script>
      
      <script type="text/javascript">
      var duoshuoQuery = {short_name:"javachen"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = 'http://static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] ||
        document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
      

      <script type="text/javascript">
      $('#qr').qrcode({
          width: 128,
          height: 128,
          text: 'http://blog.javachen.com/2013/07/20/install-rhadoop.html'
      });
      </script>
  </body>
</html>
